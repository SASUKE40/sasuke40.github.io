<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e3ca7fb2adcef8ecde0f.css">@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}[data-rmiz-wrap=hidden],[data-rmiz-wrap=visible]{position:relative;display:inline-flex;align-items:flex-start}[data-rmiz-wrap=hidden]{visibility:hidden}[data-rmiz-overlay]{position:fixed;top:0;right:0;bottom:0;left:0;width:100%;height:100%;transition-property:background-color}[data-rmiz-btn-close],[data-rmiz-btn-open]{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;margin:0;padding:0;border:none;border-radius:0;font:inherit;color:inherit;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none}[data-rmiz-btn-open]{cursor:zoom-in}[data-rmiz-btn-close]{cursor:zoom-out}[data-rmiz-modal-content]{position:absolute;transition-property:transform;transform-origin:center center}</style><meta name="generator" content="Gatsby 2.24.63"/><title data-react-helmet="true">你可能不需要 Derived State</title><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" http-equiv="X-UA-Compatible" content="IE=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="theme-color" content="#fff"/><meta data-react-helmet="true" itemProp="name" content="你可能不需要 Derived State"/><meta data-react-helmet="true" itemProp="description" content="React 16.4 包含了一个   getDerivedStateFromProps 的 bugfix ，这个 bug 导致一些 React 组件潜在的 bug…"/><meta data-react-helmet="true" itemProp="image" content="https://edward40.com/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg"/><meta data-react-helmet="true" name="description" content="React 16.4 包含了一个   getDerivedStateFromProps 的 bugfix ，这个 bug 导致一些 React 组件潜在的 bug…"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:site" content="Edward Elric"/><meta data-react-helmet="true" name="twitter:title" content="你可能不需要 Derived State"/><meta data-react-helmet="true" name="twitter:description" content="React 16.4 包含了一个   getDerivedStateFromProps 的 bugfix ，这个 bug 导致一些 React 组件潜在的 bug…"/><meta data-react-helmet="true" name="twitter:creator" content="https://twitter.com/sasuke688848"/><meta data-react-helmet="true" name="twitter:image" content="https://edward40.com/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="你可能不需要 Derived State"/><meta data-react-helmet="true" property="og:url" content="https://edward40.com/you-may-dont-need-drevied-state"/><meta data-react-helmet="true" property="og:image" content="https://edward40.com/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg"/><meta data-react-helmet="true" property="og:description" content="React 16.4 包含了一个   getDerivedStateFromProps 的 bugfix ，这个 bug 导致一些 React 组件潜在的 bug…"/><meta data-react-helmet="true" property="og:site_name" content="Edward Elric"/><meta data-react-helmet="true" name="article:published_time" content="June 15th, 2018"/><meta data-react-helmet="true" name="twitter:label1" value="Reading time"/><meta data-react-helmet="true" name="twitter:data1" value="2 min read"/><script data-react-helmet="true" type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://edward40.com/#organization","name":"Edward Elric's Blog","url":"https://edward40.com","sameAs":["https://twitter.com/sasuke688848","https://github.com/sasuke40","https://www.linkedin.com/in/sasuke/","undefined"],"logo":{"@type":"ImageObject","@id":"https://edward40.com/#logo","inLanguage":"en-US","url":"https://edward40.com/icons/icon-512x512.png","width":512,"height":512,"caption":"Edward Elric's Blog"},"image":{"@id":"https://edward40.com/#logo"}},{"@type":"WebSite","@id":"https://edward40.com/#website","url":"https://edward40.com","name":"Edward Elric","description":"Stay Hungry Stay Foolish","publisher":{"@id":"https://edward40.com/#organization"},"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://edward40.com/you-may-dont-need-drevied-state/#primaryimage","inLanguage":"en-US","url":"https://edward40.com/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg","width":1200,"height":628},{"@type":["WebPage"],"@id":"https://edward40.com/you-may-dont-need-drevied-state/#webpage","url":"https://edward40.com/you-may-dont-need-drevied-state","name":"你可能不需要 Derived State","isPartOf":{"@id":"https://edward40.com/#website"},"primaryImageOfPage":{"@id":"https://edward40.com/you-may-dont-need-drevied-state/#primaryimage"},"datePublished":"2018-06-15T00:00:00.000Z","dateModified":"2018-06-15T00:00:00.000Z","description":"React 16.4 包含了一个   getDerivedStateFromProps 的 bugfix ，这个 bug 导致一些 React 组件潜在的 bug…","breadcrumb":{"@id":"https://edward40.com/you-may-dont-need-drevied-state/#breadcrumb"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","@id":"https://edward40.com/you-may-dont-need-drevied-state/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://edward40.com","url":"https://edward40.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://edward40.com/you-may-dont-need-drevied-state","url":"https://edward40.com/you-may-dont-need-drevied-state","name":"你可能不需要 Derived State"}}]},{"@type":"Article","@id":"https://edward40.com/you-may-dont-need-drevied-state/#article","isPartOf":{"@id":"https://edward40.com/you-may-dont-need-drevied-state/#webpage"},"author":{"@id":"https://edward40.com/#/schema/authors/edward-elric"},"headline":"你可能不需要 Derived State","datePublished":"2018-06-15T00:00:00.000Z","dateModified":"2018-06-15T00:00:00.000Z","mainEntityOfPage":{"@id":"https://edward40.com/you-may-dont-need-drevied-state/#webpage"},"publisher":{"@id":"https://edward40.com/#organization"},"image":{"@id":"https://edward40.com/you-may-dont-need-drevied-state/#primaryimage"},"inLanguage":"en-US"},{"@type":["Person"],"@id":"https://edward40.com/#/schema/authors/edward-elric","name":"Edward Elric","image":{"@type":"ImageObject","@id":"https://edward40.com/#personlogo","inLanguage":"en-US","caption":"Edward Elric"},"description":"Written by Edward Elric who lives and works in China
building useful things.
","sameAs":["https://twitter.com/sasuke688848","https://github.com/sasuke40","https://www.linkedin.com/in/sasuke/","undefined"]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=ce8bfa44d476d8e731987714a8c0b6f2" type="image/png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ce8bfa44d476d8e731987714a8c0b6f2"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-700df7a2a709dc6130bc.js"/><link as="script" rel="preload" href="/framework-781d8c3da2b97ab386a4.js"/><link as="script" rel="preload" href="/app-999d510888aa9729ca86.js"/><link as="script" rel="preload" href="/styles-c2fe8482057191dca484.js"/><link as="script" rel="preload" href="/044b48a8-21ca9a5926eae6d84c26.js"/><link as="script" rel="preload" href="/22df2c6f0e0b02f286186edbe62a3193fb639611-7c41ec640e6ee50925fa.js"/><link as="script" rel="preload" href="/f7f859cd4bf156c2acc6f46f65ba39cb35d4c0a9-5e5598041298502b7a9c.js"/><link as="script" rel="preload" href="/component---node-modules-narative-gatsby-theme-novela-src-templates-article-template-tsx-aeb6e8ffda4b46761019.js"/><link as="fetch" rel="preload" href="/page-data/you-may-dont-need-drevied-state/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1143375668.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1491088328.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1921650733.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2068910035.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2444214635.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="acmv4e">body{--theme-ui-colors-prism-token:var(--theme-ui-colors-prism-token,#fff);--theme-ui-colors-prism-languageJavascript:var(--theme-ui-colors-prism-languageJavascript,#e8696b);--theme-ui-colors-prism-javascript:var(--theme-ui-colors-prism-javascript,#e8696b);--theme-ui-colors-prism-background:var(--theme-ui-colors-prism-background,#292c34);--theme-ui-colors-prism-comment:var(--theme-ui-colors-prism-comment,#5e6a76);--theme-ui-colors-prism-string:var(--theme-ui-colors-prism-string,#a8e2a8);--theme-ui-colors-prism-var:var(--theme-ui-colors-prism-var,#b3bac5);--theme-ui-colors-prism-number:var(--theme-ui-colors-prism-number,#e4854d);--theme-ui-colors-prism-constant:var(--theme-ui-colors-prism-constant,#b3bac5);--theme-ui-colors-prism-plain:var(--theme-ui-colors-prism-plain,#fff);--theme-ui-colors-prism-doctype:var(--theme-ui-colors-prism-doctype,#e8696b);--theme-ui-colors-prism-tag:var(--theme-ui-colors-prism-tag,#e8696b);--theme-ui-colors-prism-keyword:var(--theme-ui-colors-prism-keyword,#d49fd4);--theme-ui-colors-prism-boolean:var(--theme-ui-colors-prism-boolean,#ff5874);--theme-ui-colors-prism-function:var(--theme-ui-colors-prism-function,#5F8DC3);--theme-ui-colors-prism-parameter:var(--theme-ui-colors-prism-parameter,#F9965D);--theme-ui-colors-prism-className:var(--theme-ui-colors-prism-className,#ffcf74);--theme-ui-colors-prism-attrName:var(--theme-ui-colors-prism-attrName,#bf87ba);--theme-ui-colors-prism-attrValue:var(--theme-ui-colors-prism-attrValue,#a8e2a8);--theme-ui-colors-prism-interpolation:var(--theme-ui-colors-prism-interpolation,#fff);--theme-ui-colors-prism-punctuation:var(--theme-ui-colors-prism-punctuation,#5FA8AA);--theme-ui-colors-prism-maybe-class-name:var(--theme-ui-colors-prism-maybe-class-name,#fff);--theme-ui-colors-prism-property:var(--theme-ui-colors-prism-property,#80cbc4);--theme-ui-colors-prism-propertyAccess:var(--theme-ui-colors-prism-propertyAccess,#fff);--theme-ui-colors-prism-namespace:var(--theme-ui-colors-prism-namespace,#b2ccd6);--theme-ui-colors-prism-highlight:var(--theme-ui-colors-prism-highlight,rgba(255,255,255,0.07));--theme-ui-colors-prism-highlightBorder:var(--theme-ui-colors-prism-highlightBorder,#e1bde2);--theme-ui-colors-prism-dom:var(--theme-ui-colors-prism-dom,#5F8DC3);--theme-ui-colors-prism-operator:var(--theme-ui-colors-prism-operator,#5FA8AA);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#000);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#73737D);--theme-ui-colors-grey:var(--theme-ui-colors-grey,#73737D);--theme-ui-colors-background:var(--theme-ui-colors-background,#fafafa);--theme-ui-colors-accent:var(--theme-ui-colors-accent,#6166DC);--theme-ui-colors-hover:var(--theme-ui-colors-hover,rgba(0,0,0,0.07));--theme-ui-colors-gradient:var(--theme-ui-colors-gradient,linear-gradient(180deg,rgba(217,219,224,0) 0%,#D9DBE0 100%));--theme-ui-colors-articleText:var(--theme-ui-colors-articleText,#08080B);--theme-ui-colors-track:var(--theme-ui-colors-track,rgba(8,8,11,0.3));--theme-ui-colors-progress:var(--theme-ui-colors-progress,#000);--theme-ui-colors-card:var(--theme-ui-colors-card,#fff);--theme-ui-colors-error:var(--theme-ui-colors-error,#EE565B);--theme-ui-colors-success:var(--theme-ui-colors-success,#46B17B);--theme-ui-colors-errorBackground:var(--theme-ui-colors-errorBackground,rgba(238,86,91,0.1));--theme-ui-colors-horizontalRule:var(--theme-ui-colors-horizontalRule,rgba(8,8,11,0.15));--theme-ui-colors-inputBackground:var(--theme-ui-colors-inputBackground,rgba(0,0,0,0.05));color:var(--theme-ui-colors-text,undefined);background-color:var(--theme-ui-colors-background,var(--theme-ui-colors-background,#fafafa));}body.theme-ui-dark{--theme-ui-colors-grey:var(--theme-ui-colors-modes-dark-grey,#73737D);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#fff);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#fff);--theme-ui-colors-accent:var(--theme-ui-colors-modes-dark-accent,#E9DAAC);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#111216);--theme-ui-colors-hover:var(--theme-ui-colors-modes-dark-hover,rgba(255,255,255,0.07));--theme-ui-colors-gradient:var(--theme-ui-colors-modes-dark-gradient,linear-gradient(180deg,#111216 0%,rgba(66,81,98,0.36) 100%));--theme-ui-colors-articleText:var(--theme-ui-colors-modes-dark-articleText,#fff);--theme-ui-colors-track:var(--theme-ui-colors-modes-dark-track,rgba(255,255,255,0.3));--theme-ui-colors-progress:var(--theme-ui-colors-modes-dark-progress,#fff);--theme-ui-colors-card:var(--theme-ui-colors-modes-dark-card,#1D2128);--theme-ui-colors-error:var(--theme-ui-colors-modes-dark-error,#EE565B);--theme-ui-colors-success:var(--theme-ui-colors-modes-dark-success,#46B17B);--theme-ui-colors-errorBackground:var(--theme-ui-colors-modes-dark-errorBackground,rgba(238,86,91,0.1));--theme-ui-colors-horizontalRule:var(--theme-ui-colors-modes-dark-horizontalRule,rgba(255,255,255,0.15));--theme-ui-colors-inputBackground:var(--theme-ui-colors-modes-dark-inputBackground,rgba(255,255,255,0.07));}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1birv2v">.css-1birv2v{position:relative;background:var(--theme-ui-colors-background,#fafafa);-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);min-height:100vh;}</style><div class="css-1birv2v e1u54h6q0"><style data-emotion-css="4x9btz">:root{--ease-in-quad:cubic-bezier(0.55,0.085,0.68,0.53);--ease-in-quart:cubic-bezier(0.895,0.03,0.685,0.22);--ease-out-quad:cubic-bezier(0.25,0.46,0.45,0.94);--ease-out-quart:cubic-bezier(0.165,0.84,0.44,1);--ease-in-out-quad:cubic-bezier(0.455,0.03,0.515,0.955);--ease-in-out-quart:cubic-bezier(0.77,0,0.175,1);}@font-face{font-family:"-apple-system","BlinkMacSystemFont","San Francisco","Helvetica Neue","Helvetica","Ubuntu","Roboto","Noto","Segoe UI","Arial",sans-serif;font-weight:400;font-style:normal;}*,*:before,*:after{box-sizing:inherit;margin:0;padding:0;font-size:inherit;font-display:block;}:root{-ms-overflow-style:-ms-autohiding-scrollbar;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;cursor:default;font-size:0.625rem;line-height:1.4;}body{font-family:"-apple-system","BlinkMacSystemFont","San Francisco","Helvetica Neue","Helvetica","Ubuntu","Roboto","Noto","Segoe UI","Arial",sans-serif;font-size:1.6rem;margin:0;font-weight:400;height:100%;}article{word-break:break-word;}button,a{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}a:focus{outline:none;}audio,canvas,iframe,img,svg,video{vertical-align:middle;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;}input,textarea,select,button{font-family:"-apple-system","BlinkMacSystemFont","San Francisco","Helvetica Neue","Helvetica","Ubuntu","Roboto","Noto","Segoe UI","Arial",sans-serif;}.underline{-webkit-text-decoration:underline;text-decoration:underline;}button,input,select,textarea{color:inherit;font-family:inherit;font-style:inherit;font-weight:inherit;}code,kbd,pre,samp{font-family:monospace;}fieldset,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;outline:none;background:transparent;}table{border-collapse:separate;border-spacing:0;}audio:not([controls]){display:none;}details{display:block;}input:focus,input:active{outline:none;}input[type="number"]{width:auto;}img.Image__Zoom ~ div{background:transparent !important;}</style><style data-emotion-css="il8sto">.css-il8sto{width:100%;max-width:1220px;margin:0 auto;padding:0 4rem;}@media (max-width:66.875em){.css-il8sto{max-width:850px;}}@media (max-width:45.9375em){.css-il8sto{padding:0 4rem;max-width:567px;}}@media (max-width:33.75em){.css-il8sto{max-width:100%;}}</style><section class="css-il8sto e9w9r0m0"><style data-emotion-css="ysq45m">.css-ysq45m{position:relative;z-index:100;padding-top:100px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}@media (max-width:80em){.css-ysq45m{padding-top:50px;}}@media screen and (max-height:800px){.css-ysq45m{padding-top:50px;}}</style><div class="css-ysq45m e1q3p6rm1"><style data-emotion-css="dj9cqc">.css-dj9cqc{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;left:0;}@media (max-width:80em){.css-dj9cqc{left:0;}}.css-dj9cqc[data-a11y="true"]:focus::after{content:"";position:absolute;left:-10%;top:-30%;width:120%;height:160%;border:2px solid var(--theme-ui-colors-accent,#6166DC);background:rgba(255,255,255,0.01);border-radius:5px;}.css-dj9cqc:hover .e1q3p6rm0{-webkit-transform:translateX(-3px);-ms-transform:translateX(-3px);transform:translateX(-3px);}</style><a data-a11y="false" title="Navigate back to the homepage" aria-label="Navigate back to the homepage" back="false" class="css-dj9cqc e1q3p6rm2" href="/"><svg width="200" height="32"><g><path fill="#000" d="M32 30v-2h-2v-12h2v-2h-6v2h2v12h-6v-12h2v-2h-6v2h2v12h-6v-12h2v-2h-6v2h2v12h-6v-12h2v-2h-6v2h2v12h-2v2h-2v2h34v-2h-2z"></path><path fill="#000" d="M16 0h2l16 10v2h-34v-2l16-10z"></path><text font-weight="bold" y="24" x="48" fill="#000">Edward</text><text y="24" x="110" fill="#73737D">Elric</text></g></svg><style data-emotion-css="10l5b14">.css-10l5b14{position:absolute;display:inline-block;opacity:0;width:0px;height:0px;visibility:hidden;overflow:hidden;}</style><span class="css-10l5b14 e1q3p6rm8">Navigate back to the homepage</span></a><style data-emotion-css="1qdrnpx">.css-1qdrnpx{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width:33.75em){.css-1qdrnpx{right:-5px;}}</style><div class="css-1qdrnpx e1q3p6rm3"><style data-emotion-css="4zc6l3">.css-4zc6l3{opacity:0.5;position:relative;border-radius:5px;width:40px;height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;margin-left:30px;}.css-4zc6l3:hover{opacity:1;}.css-4zc6l3[data-a11y="true"]:focus::after{content:"";position:absolute;left:0;top:-30%;width:100%;height:160%;border:2px solid var(--theme-ui-colors-accent,#6166DC);background:rgba(255,255,255,0.01);border-radius:5px;}@media (max-width:45.9375em){.css-4zc6l3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-transform:scale(0.708);-ms-transform:scale(0.708);transform:scale(0.708);margin-left:10px;}.css-4zc6l3:hover{opacity:0.5;}}</style><button data-a11y="false" aria-label="Copy URL to clipboard" title="Copy URL to clipboard" class="css-4zc6l3 e1q3p6rm5"><svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2H14C15.6567 2 17 3.34328 17 5V9C17 10.6567 15.6567 12 14 12H10C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14H14C16.7613 14 19 11.7613 19 9V5C19 2.23872 16.7613 0 14 0H5C2.23872 0 0 2.23872 0 5V9C0 10.4938 0.656313 11.8361 1.6935 12.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625C3.47028 12.2483 3.43068 11.6164 3.0165 11.2511C2.39169 10.6999 2 9.89621 2 9V5ZM7 11C7 9.34328 8.34328 8 10 8H14C14.5523 8 15 7.55228 15 7C15 6.44772 14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11V15C5 17.7613 7.23872 20 10 20H19C21.7613 20 24 17.7613 24 15V11C24 9.50621 23.3437 8.16393 22.3065 7.24906C21.8923 6.88372 21.2604 6.92332 20.8951 7.3375C20.5297 7.75168 20.5693 8.38361 20.9835 8.74894C21.6083 9.30007 22 10.1038 22 11V15C22 16.6567 20.6567 18 19 18H10C8.34328 18 7 16.6567 7 15V11Z" fill="#000"></path></svg><style data-emotion-css="16kvgc5">.css-16kvgc5{position:absolute;padding:4px 13px;background:rgba(0,0,0,0.1);color:#000;border-radius:5px;font-size:14px;top:-35px;opacity:0;-webkit-transform:none;-ms-transform:none;transform:none;-webkit-transition:-webkit-transform 0.3s ease-in-out,opacity 0.3s ease-in-out;-webkit-transition:transform 0.3s ease-in-out,opacity 0.3s ease-in-out;transition:transform 0.3s ease-in-out,opacity 0.3s ease-in-out;}.css-16kvgc5::after{content:"";position:absolute;left:0;right:0;bottom:-6px;margin:0 auto;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid rgba(0,0,0,0.1);}</style><div class="css-16kvgc5 e1q3p6rm4">Copied</div></button><button data-a11y="false" aria-label="Activate dark mode" title="Activate dark mode" class="css-4zc6l3 e1q3p6rm5"><style data-emotion-css="jmdf3f">.css-jmdf3f{position:relative;width:24px;height:24px;border-radius:50%;border:2px solid var(--theme-ui-colors-primary,#000);background:var(--theme-ui-colors-primary,#000);-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all 0.45s ease;transition:all 0.45s ease;overflow:hidden;}.css-jmdf3f::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-primary,#000);border-radius:50%;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);opacity:1;-webkit-transition:-webkit-transform 0.45s ease;-webkit-transition:transform 0.45s ease;transition:transform 0.45s ease;}.css-jmdf3f::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-primary,#000),0 23px 0 var(--theme-ui-colors-primary,#000),23px 0 0 var(--theme-ui-colors-primary,#000),-23px 0 0 var(--theme-ui-colors-primary,#000),15px 15px 0 var(--theme-ui-colors-primary,#000),-15px 15px 0 var(--theme-ui-colors-primary,#000),15px -15px 0 var(--theme-ui-colors-primary,#000),-15px -15px 0 var(--theme-ui-colors-primary,#000);-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transition:all 0.35s ease;transition:all 0.35s ease;}@media (max-width:45.9375em){.css-jmdf3f::after{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}}</style><div class="css-jmdf3f e1q3p6rm6"></div><style data-emotion-css="1k5uyy5">.css-1k5uyy5{position:absolute;right:-1px;top:-8px;height:24px;width:24px;border-radius:50%;border:0;background:var(--theme-ui-colors-background,#fafafa);-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);opacity:1;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad),-webkit-transform 0.45s ease;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad),transform 0.45s ease;transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad),transform 0.45s ease;}</style><div class="css-1k5uyy5 e1q3p6rm7"></div></button></div></div></section><style data-emotion-css="wn0kt9">@media (max-width:33.75em){.css-wn0kt9::before{content:"";width:100%;height:20px;background:var(--theme-ui-colors-primary,#000);position:absolute;left:0;top:0;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);}.css-wn0kt9::after{content:"";width:100%;height:10px;background:var(--theme-ui-colors-background,#fafafa);position:absolute;left:0;top:10px;border-top-left-radius:25px;border-top-right-radius:25px;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);}}</style><div class="css-wn0kt9 e1oyruom0"><style data-emotion-css="1ito37z">.css-1ito37z{position:relative;z-index:10;margin:100px auto 120px;padding-left:68px;max-width:749px;}@media (max-width:66.875em){.css-1ito37z{padding-left:53px;max-width:calc(507px + 53px);margin:100px auto 70px;}}@media (max-width:45.9375em){.css-1ito37z{padding-left:0;margin:100px auto 70px;max-width:480px;}}@media (max-width:33.75em){.css-1ito37z{margin:170px auto 180px;padding:0 40px;}}@media screen and (max-height:700px){.css-1ito37z{margin:100px auto;}}</style><header class="css-1ito37z e1oyruom2"><style data-emotion-css="1fu6lzh">.css-1fu6lzh{word-break:keep-all;font-size:52px;line-height:1.15;font-weight:bold;color:var(--theme-ui-colors-primary,#000);font-family:'Merriweather',Georgia,Serif;font-size:48px;font-family:'Merriweather',Georgia,Serif;margin-bottom:25px;font-weight:bold;line-height:1.32;}@media (max-width:66.875em){.css-1fu6lzh{font-size:38px;line-height:1.2;}}@media (max-width:33.75em){.css-1fu6lzh{font-size:32px;line-height:1.3;}}@media (max-width:45.9375em){.css-1fu6lzh{margin-bottom:20px;font-size:36px;}}@media (max-width:33.75em){.css-1fu6lzh{font-size:32px;}}</style><h1 class="css-1fu6lzh e1oyruom3">你可能不需要 Derived State</h1><style data-emotion-css="sdvpri">.css-sdvpri{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:18px;color:var(--theme-ui-colors-grey,#73737D);}@media (max-width:33.75em){.css-sdvpri{font-size:14px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-sdvpri strong{display:block;font-weight:500;margin-bottom:5px;}}</style><div class="css-sdvpri e1oyruom4"><style data-emotion-css="1mpu0fb">.css-1mpu0fb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;}.css-1mpu0fb strong{-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);}.css-1mpu0fb:hover strong{color:var(--theme-ui-colors-primary,#000);}</style><a class="css-1mpu0fb e6hdldi2" href="/authors/edward-elric"><style data-emotion-css="u1pf06">.css-u1pf06{height:25px;width:25px;border-radius:50%;margin-right:14px;background:var(--theme-ui-colors-grey,#73737D);overflow:hidden;}.css-u1pf06 .gatsby-image-wrapper > div{padding-bottom:100% !important;}@media (max-width:33.75em){.css-u1pf06{display:none;}}</style><div class="css-u1pf06 e6hdldi0"><style data-emotion-css="uodor8">.css-uodor8{border-radius:50%;}</style><style data-emotion-css="1qspsgn">.css-1qspsgn{border-radius:50%;}.css-1qspsgn > img{-webkit-filter:blur(8px);filter:blur(8px);}</style><div class="e6hdldi1 css-1qspsgn e13158qv0 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:100%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHrodCbiuQrREWAc//EABsQAAIDAAMAAAAAAAAAAAAAAAABAgMSESFB/9oACAEBAAEFAvUcIdj0rTZIXUGz/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQETFB/9oACAEDAQE/AcJFpv/EABYRAQEBAAAAAAAAAAAAAAAAABABQf/aAAgBAgEBPwHSn//EABkQAAIDAQAAAAAAAAAAAAAAAAAQATFxAv/aAAgBAQAGPwJ0Upw5xf/EABwQAQACAwADAAAAAAAAAAAAAAEAIRExUUFhcf/aAAgBAQABPyF1EljjOrAEKDfZm3R1MPI59XNlCVG8Iuftz//aAAwDAQACAAMAAAAQnBcB/8QAGREAAwADAAAAAAAAAAAAAAAAAAEREDFR/9oACAEDAQE/EFHDI5iez//EABkRAQACAwAAAAAAAAAAAAAAAAEAEBEhMf/aAAgBAgEBPxByU4i7n//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQYFRcf/aAAgBAQABPxCpZF4PsNjtnZVQAq17qNhwI1fkVtnJfk72G1a3Ax7MDWxPuxQtIvkBaiwLXmp//9k=" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/ce8bfa44d476d8e731987714a8c0b6f2/58718/edward-elric.webp 13w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/74aad/edward-elric.webp 25w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/e7b2c/edward-elric.webp 50w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/ed320/edward-elric.webp 75w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/66016/edward-elric.webp 100w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/0bc1d/edward-elric.webp 300w" sizes="(max-width: 50px) 100vw, 50px" /><source srcset="/static/ce8bfa44d476d8e731987714a8c0b6f2/afb2b/edward-elric.jpg 13w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/7c20e/edward-elric.jpg 25w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/fa1ea/edward-elric.jpg 50w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/03612/edward-elric.jpg 75w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/61cdf/edward-elric.jpg 100w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/88b18/edward-elric.jpg 300w" sizes="(max-width: 50px) 100vw, 50px" /><img loading="lazy" sizes="(max-width: 50px) 100vw, 50px" srcset="/static/ce8bfa44d476d8e731987714a8c0b6f2/afb2b/edward-elric.jpg 13w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/7c20e/edward-elric.jpg 25w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/fa1ea/edward-elric.jpg 50w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/03612/edward-elric.jpg 75w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/61cdf/edward-elric.jpg 100w,
/static/ce8bfa44d476d8e731987714a8c0b6f2/88b18/edward-elric.jpg 300w" src="/static/ce8bfa44d476d8e731987714a8c0b6f2/fa1ea/edward-elric.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><strong>Edward Elric</strong><style data-emotion-css="sjizha">@media (max-width:33.75em){.css-sjizha{display:none;}}</style><span class="css-sjizha e6hdldi13">, </span></a><style data-emotion-css="1d64qrg">.css-1d64qrg{margin-left:0;}@media (max-width:33.75em){.css-1d64qrg{margin-left:0;}}</style><div class="css-1d64qrg e1oyruom1">June 15th, 2018<!-- --> · <!-- -->2<!-- --> min read</div></div></header><style data-emotion-css="15rikwz">.css-15rikwz{position:relative;z-index:1;width:100%;max-width:944px;overflow:hidden;margin:0 auto;box-shadow:0 30px 60px -10px rgba(0,0,0,0.2),0 18px 36px -18px rgba(0,0,0,0.22);}@media (max-width:45.9375em){.css-15rikwz{max-width:100%;}}@media (max-width:33.75em){.css-15rikwz{margin:0 auto;width:calc(100vw - 40px);height:220px;}.css-15rikwz > div{height:220px;}}</style><div id="ArticleImage__Hero" class="css-15rikwz e1oyruom5"><style data-emotion-css="133qvua">.css-133qvua > img{-webkit-filter:blur(8px);filter:blur(8px);}</style><div class="css-133qvua e13158qv0 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:41.52542372881356%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHcgiwr/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bp//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABYQAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAQABPyG7UY//2gAMAwEAAgADAAAAEPfP/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Qh//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxAwv//EABgQAQEBAQEAAAAAAAAAAAAAAAEAEVFx/9oACAEBAAE/EACKuPkHUQS1y//Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/6986addc146b07e2d2557d267011f063/77392/react-derived-state.webp 236w,
/static/6986addc146b07e2d2557d267011f063/1f177/react-derived-state.webp 472w,
/static/6986addc146b07e2d2557d267011f063/99fbb/react-derived-state.webp 944w,
/static/6986addc146b07e2d2557d267011f063/9000d/react-derived-state.webp 1200w" sizes="(max-width: 944px) 100vw, 944px" /><source srcset="/static/6986addc146b07e2d2557d267011f063/e0f30/react-derived-state.jpg 236w,
/static/6986addc146b07e2d2557d267011f063/86afd/react-derived-state.jpg 472w,
/static/6986addc146b07e2d2557d267011f063/58fe7/react-derived-state.jpg 944w,
/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg 1200w" sizes="(max-width: 944px) 100vw, 944px" /><img loading="lazy" sizes="(max-width: 944px) 100vw, 944px" srcset="/static/6986addc146b07e2d2557d267011f063/e0f30/react-derived-state.jpg 236w,
/static/6986addc146b07e2d2557d267011f063/86afd/react-derived-state.jpg 472w,
/static/6986addc146b07e2d2557d267011f063/58fe7/react-derived-state.jpg 944w,
/static/6986addc146b07e2d2557d267011f063/0ff54/react-derived-state.jpg 1200w" src="/static/6986addc146b07e2d2557d267011f063/58fe7/react-derived-state.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div></div><style data-emotion-css="145b7r6">.css-145b7r6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 auto;max-width:1140px;}@media (max-width:80em){.css-145b7r6{display:none;}}</style><aside class="css-145b7r6 eb5z70c0"><style data-emotion-css="18dj233">.css-18dj233{position:absolute;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-transform:translateY(0px);-ms-transform:translateY(0px);transform:translateY(0px);top:0px;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;height:100vh;z-index:3;opacity:0;visibility:hidden;-webkit-transition:opacity 0.2s linear,visibility 0.4s linear;transition:opacity 0.2s linear,visibility 0.4s linear;}</style><div class="css-18dj233 eb5z70c1"><div><style data-emotion-css="155spwp">.css-155spwp{-webkit-user-select:initial;-moz-user-select:initial;-ms-user-select:initial;user-select:initial;pointer-events:initial;opacity:1;-webkit-transition:opacity 0.25s;transition:opacity 0.25s;}</style><div class="css-155spwp e1fnsvio0"><style data-emotion-css="1elne8e">.css-1elne8e{position:relative;outline:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><div tabindex="-1" class="css-1elne8e ewxdfzj0"><style data-emotion-css="iefrkk">.css-iefrkk{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:calc(88vh - 40px);max-height:425px;width:1px;background-color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));opacity:0.6;overflow:hidden;}</style><div aria-hidden="true" class="css-iefrkk ewxdfzj1"><style data-emotion-css="1qno6mr">.css-1qno6mr{position:absolute;height:100%;top:-100%;width:1px;background-color:var(--theme-ui-colors-progress,#000);left:0;}</style><div style="transform:translateY(0%)" class="css-1qno6mr ewxdfzj2"></div></div></div></div></div></div></aside><style data-emotion-css="19mic43">.css-19mic43{position:relative;padding-top:60px;-webkit-transition:background 0.2s linear;transition:background 0.2s linear;text-align:center;}@media (min-width:33.8125em){.css-19mic43{display:none;}}</style><div class="css-19mic43 eih7p4r0"><style data-emotion-css="gmuwbf">.css-gmuwbf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="css-gmuwbf e1d5uww60"><style data-emotion-css="1yxfb37">.css-1yxfb37{opacity:0.5;position:relative;z-index:200000000;border-radius:5px;width:40px;height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;margin-left:30px;}.css-1yxfb37:hover{opacity:1;}@media (max-width:45.9375em){.css-1yxfb37{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-transform:scale(0.9);-ms-transform:scale(0.9);transform:scale(0.9);margin:0 15px;}.css-1yxfb37:hover{opacity:0.5;}}</style><button data-a11y="false" aria-label="Copy URL to clipboard" class="css-1yxfb37 e1d5uww62"><svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2H14C15.6567 2 17 3.34328 17 5V9C17 10.6567 15.6567 12 14 12H10C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14H14C16.7613 14 19 11.7613 19 9V5C19 2.23872 16.7613 0 14 0H5C2.23872 0 0 2.23872 0 5V9C0 10.4938 0.656313 11.8361 1.6935 12.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625C3.47028 12.2483 3.43068 11.6164 3.0165 11.2511C2.39169 10.6999 2 9.89621 2 9V5ZM7 11C7 9.34328 8.34328 8 10 8H14C14.5523 8 15 7.55228 15 7C15 6.44772 14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11V15C5 17.7613 7.23872 20 10 20H19C21.7613 20 24 17.7613 24 15V11C24 9.50621 23.3437 8.16393 22.3065 7.24906C21.8923 6.88372 21.2604 6.92332 20.8951 7.3375C20.5297 7.75168 20.5693 8.38361 20.9835 8.74894C21.6083 9.30007 22 10.1038 22 11V15C22 16.6567 20.6567 18 19 18H10C8.34328 18 7 16.6567 7 15V11Z" fill="black"></path></svg><div class="css-16kvgc5 e1d5uww61">Copied</div></button><button aria-label="Toggle dark and light mode" class="css-1yxfb37 e1d5uww62"><div class="css-jmdf3f e1d5uww63"></div><style data-emotion-css="mslqme">.css-mslqme{position:absolute;right:-1px;top:-8px;height:24px;width:24px;border-radius:50%;border:0;background:var(--theme-ui-colors-background,#fafafa);-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);opacity:1;-webkit-transition:-webkit-transform 0.45s ease,background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);-webkit-transition:transform 0.45s ease,background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:transform 0.45s ease,background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);}</style><div class="css-mslqme e1d5uww64"></div></button></div></div><style data-emotion-css="1j2ibf0">.css-1j2ibf0{position:relative;padding:160px 0 35px;padding-left:68px;-webkit-transition:background 0.2s linear;transition:background 0.2s linear;}@media (max-width:66.875em){.css-1j2ibf0{padding-left:53px;}}@media (max-width:45.9375em){.css-1j2ibf0{padding:70px 0 80px;}}@media (max-width:33.75em){.css-1j2ibf0{padding:60px 0;}}</style><article class="css-1j2ibf0 eih7p4r1"><style data-emotion-css="rb52af">.css-rb52af{position:relative;z-index:10;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-rb52af h1,.css-rb52af h2,.css-rb52af h3,.css-rb52af h4,.css-rb52af h5,.css-rb52af h6{margin:0 auto;}.css-rb52af h1,.css-rb52af h1 *,.css-rb52af h2,.css-rb52af h2 *{margin:25px auto 18px;}@media (max-width:45.9375em){.css-rb52af h1,.css-rb52af h1 *,.css-rb52af h2,.css-rb52af h2 *{margin:30px auto 18px;}}.css-rb52af h3,.css-rb52af h3 *{margin:20px auto 10px;}.css-rb52af h1,.css-rb52af h2,.css-rb52af h3,.css-rb52af h4,.css-rb52af h5,.css-rb52af h6{width:100%;max-width:680px;}@media (max-width:66.875em){.css-rb52af h1,.css-rb52af h2,.css-rb52af h3,.css-rb52af h4,.css-rb52af h5,.css-rb52af h6{max-width:507px;}}@media (max-width:45.9375em){.css-rb52af h1,.css-rb52af h2,.css-rb52af h3,.css-rb52af h4,.css-rb52af h5,.css-rb52af h6{max-width:486px;}}@media (max-width:33.75em){.css-rb52af h1,.css-rb52af h2,.css-rb52af h3,.css-rb52af h4,.css-rb52af h5,.css-rb52af h6{padding:0 20px;}}.css-rb52af .prism-code{overflow:auto;width:100%;max-width:744px;margin:0 auto;padding:32px;font-size:13px;margin:15px auto 50px;border-radius:5px;font-family:"Operator Mono",Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;background:var(--theme-ui-colors-prism-background,#292c34);}.css-rb52af .prism-code .token-line{border-left:3px solid transparent;}.css-rb52af .prism-code .token-line .token{color:var(--theme-ui-colors-prism-token,#fff);}.css-rb52af .prism-code .token-line .language-javascript{color:var(--theme-ui-colors-prism-languageJavascript,#e8696b);}.css-rb52af .prism-code .token-line .javascript{color:var(--theme-ui-colors-prism-javascript,#e8696b);}.css-rb52af .prism-code .token-line .background{color:var(--theme-ui-colors-prism-background,#292c34);}.css-rb52af .prism-code .token-line .comment{color:var(--theme-ui-colors-prism-comment,#5e6a76);}.css-rb52af .prism-code .token-line .string{color:var(--theme-ui-colors-prism-string,#a8e2a8);}.css-rb52af .prism-code .token-line .var{color:var(--theme-ui-colors-prism-var,#b3bac5);}.css-rb52af .prism-code .token-line .number{color:var(--theme-ui-colors-prism-number,#e4854d);}.css-rb52af .prism-code .token-line .constant{color:var(--theme-ui-colors-prism-constant,#b3bac5);}.css-rb52af .prism-code .token-line .plain{color:var(--theme-ui-colors-prism-plain,#fff);}.css-rb52af .prism-code .token-line .doctype{color:var(--theme-ui-colors-prism-doctype,#e8696b);}.css-rb52af .prism-code .token-line .tag{color:var(--theme-ui-colors-prism-tag,#e8696b);}.css-rb52af .prism-code .token-line .keyword{color:var(--theme-ui-colors-prism-keyword,#d49fd4);}.css-rb52af .prism-code .token-line .boolean{color:var(--theme-ui-colors-prism-boolean,#ff5874);}.css-rb52af .prism-code .token-line .function{color:var(--theme-ui-colors-prism-function,#5F8DC3);}.css-rb52af .prism-code .token-line .parameter{color:var(--theme-ui-colors-prism-parameter,#F9965D);}.css-rb52af .prism-code .token-line .class-name{color:var(--theme-ui-colors-prism-className,#ffcf74);}.css-rb52af .prism-code .token-line .attr-name{color:var(--theme-ui-colors-prism-attrName,#bf87ba);}.css-rb52af .prism-code .token-line .attr-value{color:var(--theme-ui-colors-prism-attrValue,#a8e2a8);}.css-rb52af .prism-code .token-line .interpolation{color:var(--theme-ui-colors-prism-interpolation,#fff);}.css-rb52af .prism-code .token-line .punctuation{color:var(--theme-ui-colors-prism-punctuation,#5FA8AA);}.css-rb52af .prism-code .token-line .maybe-class-name{color:var(--theme-ui-colors-prism-maybe-class-name,#fff);}.css-rb52af .prism-code .token-line .property{color:var(--theme-ui-colors-prism-property,#80cbc4);}.css-rb52af .prism-code .token-line .property-access{color:var(--theme-ui-colors-prism-propertyAccess,#fff);}.css-rb52af .prism-code .token-line .namespace{color:var(--theme-ui-colors-prism-namespace,#b2ccd6);}.css-rb52af .prism-code .token-line .highlight{color:var(--theme-ui-colors-prism-highlight,rgba(255,255,255,0.07));}.css-rb52af .prism-code .token-line .highlight-border{color:var(--theme-ui-colors-prism-highlightBorder,#e1bde2);}.css-rb52af .prism-code .token-line .dom{color:var(--theme-ui-colors-prism-dom,#5F8DC3);}.css-rb52af .prism-code .token-line .operator{color:var(--theme-ui-colors-prism-operator,#5FA8AA);}.css-rb52af .prism-code .number-line{display:inline-block;width:32px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;color:#dcd9e6;}@media (max-width:45.9375em){.css-rb52af .prism-code .number-line{opacity:0;width:0;}}.css-rb52af .prism-code .token-line.highlight-line{margin:0 -32px;padding:0 32px;background:var(--theme-ui-colors-prism-highlight,rgba(255,255,255,0.07));border-left:3px solid var(--theme-ui-colors-prism-highlightBorder,#e1bde2);}@media (max-width:45.9375em){.css-rb52af .prism-code .token-line.highlight-line{margin:0 -20px;padding:0 20px;}}.css-rb52af .prism-code .operator + .maybe-class-name{color:#ffcf74 !important;}.css-rb52af .prism-code .plain ~ .operator{color:#5fa8aa !important;}@media (max-width:66.875em){.css-rb52af .prism-code{left:-26px;}}@media (max-width:45.9375em){.css-rb52af .prism-code{max-width:526px;padding:20px 20px;left:0;}}@media (max-width:33.75em){.css-rb52af .prism-code{-webkit-text-size-adjust:none;text-size-adjust:none;border-radius:0;margin:0 auto 25px;padding:25px 20px;overflow:initial;width:unset;max-width:unset;float:left;min-width:100%;overflow:initial;position:relative;}}.css-rb52af .gatsby-resp-image-background-image{display:none !important;}.css-rb52af img{display:inline-block;position:relative;max-width:100%;height:auto;z-index:0;margin:15px auto 50px;border-radius:5px;}@media (max-width:45.9375em){.css-rb52af img{margin:10px auto 45px;}}.css-rb52af div.Image__Small{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;max-width:100%;height:auto;z-index:0;margin:15px auto 50px;border-radius:5px;width:100%;max-width:680px;}@media (max-width:45.9375em){.css-rb52af div.Image__Small{margin:10px auto 45px;}}@media (max-width:66.875em){.css-rb52af div.Image__Small{max-width:507px;}}@media (max-width:45.9375em){.css-rb52af div.Image__Small{max-width:486px;margin:0 auto 25px;}}@media (max-width:33.75em){.css-rb52af div.Image__Small{padding:0 20px;}}.css-rb52af .Image__Container{text-align:center;}.css-rb52af img.Image__With-Shadow{box-shadow:0px 15px 60px rgba(0,0,0,0.15);}.css-rb52af div.Image__Medium{position:relative;margin:15px auto 50px;width:100%;max-width:1004px;}@media (max-width:80em){.css-rb52af div.Image__Medium{left:-34px;}}@media (max-width:66.875em){.css-rb52af div.Image__Medium{left:-26px;}}@media (max-width:45.9375em){.css-rb52af div.Image__Medium{border-radius:0;left:0;margin:0 auto 25px;}.css-rb52af div.Image__Medium img{border-radius:0;}}.css-rb52af div.Image__Large{position:relative;left:-68px;width:100vw;margin:25px auto 60px;pointer-events:none;}.css-rb52af div.Image__Large iframe{pointer-events:all;}.css-rb52af div.Image__Large img{border-radius:0;}@media (max-width:66.875em){.css-rb52af div.Image__Large{left:-53px;}}@media (max-width:45.9375em){.css-rb52af div.Image__Large{left:0;margin:0 auto 25px;}}</style><div class="css-rb52af ellmdci0"><style data-emotion-css="8qp1bw">.css-8qp1bw{line-height:1.756;font-size:18px;color:var(--theme-ui-colors-articleText,#08080B);font-family:'SF Pro Display','-apple-system','BlinkMacSystemFont','San Francisco','Helvetica Neue','Helvetica','Ubuntu','Roboto','Noto','Segoe UI','Arial',sans-serif;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);margin:0 auto 35px;width:100%;max-width:680px;}.css-8qp1bw b{font-weight:800;}@media (max-width:66.875em){.css-8qp1bw{max-width:507px;}}@media (max-width:45.9375em){.css-8qp1bw{max-width:486px;margin:0 auto 25px;}}@media (max-width:33.75em){.css-8qp1bw{padding:0 20px;}}</style><p class="css-8qp1bw ezkq0ko0">React 16.4 包含了一个  <style data-emotion-css="mckguv">.css-mckguv{-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);color:var(--theme-ui-colors-accent,#6166DC);}.css-mckguv:visited{color:var(--theme-ui-colors-accent,#6166DC);opacity:0.85;}.css-mckguv:hover,.css-mckguv:focus{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/05/23/react-v-16-4.html%23bugfix-for-getderivedstatefromprops" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">getDerivedStateFromProps 的 bugfix</a>，这个 bug 导致一些 React 组件潜在的 bug 稳定复现。这个版本暴露了个案例，当你的应用正在使用反模式构建，则将会在此次修复后可能无法工作，我们对这个改动感到抱歉。在本文中，我们将阐述一些通常的使用 Derived State 的反模式以及相应的解决替代方案。</p><p class="css-8qp1bw ezkq0ko0">在很长一段时间，在 props 改变时响应 state 的更新，无需额外的渲染，唯一的途径就是  <code class="css-0">componentWillReceiveProps</code>  这个生命周期方法。在 16.3 版本下，<a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/03/29/react-v-16-3.html%23component-lifecycle-changes" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">我们介绍了一个替代的生命周期 getDerivedStateFromProps</a>  更加安全的方式来解决相同的用例。同时，我们意识到人们有很多关于使用这两个方法的错误解读，我们发现了这些反模式导致一些微妙且令人困惑的 bug。 <code class="css-0">getDerivedStateFromProps</code>  在 16.4 中做了修复，<a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/react/issues/12898" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">使得 derived state 更加可预测</a>，因此滥用的后果更加容易被留意到。
Note 
所有关于旧的  &gt; <code class="css-0">componentWillReceiveProps</code>  和新  &gt; <code class="css-0">getDerivedStateFromProps</code>  的反模式都会在本文中阐述。
这篇文章涵盖以下话题：</p><style data-emotion-css="1rpojxi">.css-1rpojxi{list-style:none;counter-reset:list;color:var(--theme-ui-colors-articleText,#08080B);position:relative;padding:15px 0 30px 30px;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);margin:0 auto;font-size:18px;width:100%;max-width:680px;}@media (max-width:66.875em){.css-1rpojxi{max-width:507px;}}@media (max-width:45.9375em){.css-1rpojxi{max-width:486px;padding-left:0px;}}@media (max-width:33.75em){.css-1rpojxi{padding-left:20px;}}.css-1rpojxi li{position:relative;padding-bottom:15px;}@media (max-width:45.9375em){.css-1rpojxi li{padding-left:30px;}}@media (max-width:33.75em){.css-1rpojxi li{padding-left:30px;}}@media (max-width:45.9375em){.css-1rpojxi li p{padding:0;}}.css-1rpojxi li >:not(ol,ul){display:inline;}.css-1rpojxi li::before{width:3rem;display:inline-block;position:absolute;color:var(--theme-ui-colors-articleText,#08080B);}.css-1rpojxi li::before{content:'';position:absolute;left:-30px;top:8px;height:8px;width:8px;background:var(--theme-ui-colors-articleText,#08080B);}@media (max-width:45.9375em){.css-1rpojxi li::before{left:0;}}</style><ul class="css-1rpojxi eouu7a70"><li class="css-0"><p class="css-8qp1bw ezkq0ko0">什么时候使用 derived state</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">使用 derived state 时通常的 bug</p><ul class="css-1rpojxi eouu7a70"><li class="css-0"><p class="css-8qp1bw ezkq0ko0">反模式：无条件地将 prop 复制给 state</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">反模式：当 props 改变时清除 state</p></li></ul></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">推荐的方案</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">什么是 memoization ？</p></li></ul><style data-emotion-css="xu77su">.css-xu77su{position:relative;width:100%;max-width:680px;margin:50px auto;border:0;height:14.36px;background-image:url("data:image/svg+xml,%3Csvg width='10' height='15' viewBox='0 0 10 15' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect x='0.567383' y='14.1777' width='16' height='1' transform='rotate(-60 0.567383 14.1777)' fill='%232D2E33'/%3E%3C/svg%3E");background-repeat:repeat-x;box-sizing:border-box;background-position:center;}@media (max-width:66.875em){.css-xu77su{max-width:507px;}}@media (max-width:45.9375em){.css-xu77su{max-width:486px;}}@media (max-width:33.75em){.css-xu77su{padding:0 20px;}}@media (max-width:45.9375em){.css-xu77su{width:calc(100vw - 40px);margin:0px auto 50px;}}</style><hr class="css-xu77su e1yst2jy0"/><style data-emotion-css="fkwewv">.css-fkwewv{word-break:keep-all;font-size:32px;line-height:1.333;font-weight:bold;color:var(--theme-ui-colors-primary,#000);font-family:'Merriweather',Georgia,Serif;}@media (max-width:66.875em){.css-fkwewv{font-size:21px;}}@media (max-width:45.9375em){.css-fkwewv{font-size:24px;line-height:1.45;}}@media (max-width:33.75em){.css-fkwewv{font-size:22px;}}</style><h2 id="什么时候使用-derived-state" class="css-fkwewv e18lclmb1">什么时候使用 Derived State</h2><p class="css-8qp1bw ezkq0ko0"><code class="css-0">getDerivedStateFromProps</code>  存在只为了一个目的。它让组件在  <strong class="css-0">props 发生改变</strong>时更新它自身的内部 state。我们之前的文章提供一些例子，例如：<a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/03/27/update-on-async-rendering.html%23updating-state-based-on-props" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">基于 offset prop 的改变记录当前滚动位置</a>或者  <a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/03/27/update-on-async-rendering.html%23fetching-external-data-when-props-change" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">通过源 prop 加载外部数据</a>。</p><p class="css-8qp1bw ezkq0ko0">我们没有提供更多的例子，因为这有一个常规的准则，<strong class="css-0">应该保守地使用 derived state</strong>。所有我们看到关于 derived state 的问题从根本上可以归结成两类：(1) 无条件的以 props 更新 state 或者 (2) 每当 props 和 state 不同时就更新 state。(我们将在下面谈到更多细节。)</p><ul class="css-1rpojxi eouu7a70"><li class="css-0"><p class="css-8qp1bw ezkq0ko0">当你使用 derived state 来暂存一些仅基于当前 props 的计算结果时，你不需要 derived state。查看  <a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html%23what-about-memoization" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">什么是 memoization ?</a></p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">当你无条件更新 derived state 抑或是每当 props 与 state 不同时更新 state，你的组件可能会频繁重置它的 state。</p></li></ul><hr class="css-xu77su e1yst2jy0"/><h2 id="使用-derived-state-时的常见-bug" class="css-fkwewv e18lclmb1">使用 Derived State 时的常见 bug</h2><p class="css-8qp1bw ezkq0ko0">“受控的” 和 “不受控的” 这两个术语经常涉及到 form 的 input，然而他们也能描述组件数据存在的位置。当数据作为 props 传递时，则数据可以被认为是<strong class="css-0">受控的</strong>(因为父组件<em class="css-0">控制</em>了这些数据)。仅存在于内部 state 的数据可以被认为是<strong class="css-0">不受控</strong>的(因为父组件不能直接改变它)。</p><p class="css-8qp1bw ezkq0ko0">derived state 的最常见错误就是混合了“受控”和“不受控”两种情况；当一个 derived state 值也使用  <code class="css-0">setState</code>  来更新时，那它数据来源就不是唯一的。上文提到的“<a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/03/27/update-on-async-rendering.html%23fetching-external-data-when-props-change" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">外部数据加载的例子</a>”看上去好像就是这样，但其实有本质上差别。在数据加载例子中，‘source’ prop 和 ‘loading’ state 都有明确的数据来源。当 ‘source’ prop <strong class="css-0">改变</strong>时， ‘loading’ state <strong class="css-0">总会</strong>被覆盖。相反地，state 当且仅当 prop 改变时才会被覆盖，否则只能被 state 所在的组件所管理。</p><p class="css-8qp1bw ezkq0ko0">当这些约束被改变时问题就浮现了。这会产生两个经典形式。让我们看一看他们。</p><h2 id="反模式：无条件地将-prop-复制给-state" class="css-fkwewv e18lclmb1">反模式：无条件地将 prop 复制给 state</h2><p class="css-8qp1bw ezkq0ko0">一个常见关于  <code class="css-0">getDerivedStateFromProps</code>  和  <code class="css-0">componentWillReceiveProps</code>  的错误理解就是他们只会在 props “变化”时调用。无论是组件重新渲染还是 props 和之前“不同”，这些生命周期方法都会被调用。基于此，这两个生命周期方法总是被用于不安全地无条件地覆盖 state。<strong class="css-0">这样做将导致 state 的更新发生丢失。</strong></p><p class="css-8qp1bw ezkq0ko0">让我们思考一个例子来说明这个问题。这里有一个  <code class="css-0">EmailInput</code>  组件“映射”了一个 email 属性在 state 中：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><style data-emotion-css="1chxjt6">.css-1chxjt6{position:absolute;right:22px;top:24px;padding:8px 12px 7px;border-radius:5px;color:#6f7177;-webkit-transition:background 0.3s ease;transition:background 0.3s ease;}.css-1chxjt6:hover{background:rgba(255,255,255,0.07);}.css-1chxjt6[data-a11y="true"]:focus::after{content:"";position:absolute;left:-2%;top:-2%;width:104%;height:104%;border:2px solid var(--theme-ui-colors-accent,#6166DC);border-radius:5px;background:rgba(255,255,255,0.01);}@media (max-width:45.9375em){.css-1chxjt6{display:none;}}</style><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">EmailInput</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">  </span><span class="token function-variable function">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain">  </span><span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">    </span><span class="token comment">// This will erase any local state updates!</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain">    </span><span class="token comment">// Do not do this.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> nextProps</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">17</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">首先，这个组件看上去没什么问题。State 被 props 传递进来的值所初始化，并在我们键入  <code class="css-0">&lt;input&gt;</code>  的时候被更新。但是如果我们的父组件重新渲染的时候，我们输入到  <code class="css-0">input</code>  的内容就会丢失(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/m3w9zn1z8x" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">看这个例子</a>)！即使我们在重置前进行比较  <code class="css-0">nextProps.email !== this.state.email</code>也会这样。</p><p class="css-8qp1bw ezkq0ko0">在这个简单的例子中，只有当 email 属性被改变时加入  <code class="css-0">shouldComponentUpdate</code>  来解决重渲染。然而在实践中，组件总是接受多个 props；另一个 prop 改变时依然会导致重渲染和不当重置。在函数和对象属性在内部被创建，在一个实质性的变化发生时，实现  <code class="css-0">shouldComponentUpdate</code>  可靠地只返回 true 值变得困难。<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/jl0w6r9w59" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">这里有个 demo 展示发生的情况</a>。因此， <code class="css-0">shouldComponentUpdate</code>  作为性能优化的最好方式被使用，而不用在 derived state 中保证正确性。</p><p class="css-8qp1bw ezkq0ko0">至此，为何<strong class="css-0">无条件地将 props 复制给 state 是一个坏想法</strong>显而易见。在 review 可能的解决方案，让我们来看看一个有关的问题模式：在 email 属性改变时，如果我们只更新 state ？</p><h2 id="反模式：当-props-改变时清除-state" class="css-fkwewv e18lclmb1">反模式：当 props 改变时清除 state</h2><p class="css-8qp1bw ezkq0ko0">继续上述的例子，当  <code class="css-0">props.email</code>  改变时，我们可以通过只更新来避免意外地清除 state：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">EmailInput</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain">    email</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">  </span><span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">    </span><span class="token comment">// Any time props.email changes, update state.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextProps</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">        email</span><span class="token punctuation">:</span><span class="token plain"> nextProps</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">Note
不仅在以上例子中  &gt; <code class="css-0">componentWillReceiveProps</code> ,一个的反模式也被用于  &gt; <code class="css-0">getDerivedStateFromProps</code>  中。
我们做了很大的改进。现在我们的组件在 props 实质变化时才会清楚我们输入的内容。</p><p class="css-8qp1bw ezkq0ko0">但依旧存在一个微妙的问题。想象一下一个密码管理应用使用上述输入组件。当在两个相同 email 的账户下切换时，输入组件重置会失败。这是因为两个账户传递给组件的 prop 值是相同的！这使得用户感到诧异，一个账户没有保存的变更会影响另一个共享同一 email 的账号上。(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/mz2lnkjkrx" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">这里看 demo</a>)</p><p class="css-8qp1bw ezkq0ko0">这种设计是有本质缺陷的，但它是最容易犯的。(<a href="https://link.zhihu.com/?target=https%3A//twitter.com/brian_d_vaughn/status/959600888242307072" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">我就犯过！</a>)幸运的是，以下有两个更好的替代方案。而关键就是对每一片数据，你需要选一个控制数据并以其作为真实源的简单组件，并避免副本数据存在于其他组件。让我们来看一下这些替代方案。</p><hr class="css-xu77su e1yst2jy0"/><h2 id="优选方案" class="css-fkwewv e18lclmb1">优选方案</h2><h2 id="推荐：完全受控组件" class="css-fkwewv e18lclmb1">推荐：完全受控组件</h2><p class="css-8qp1bw ezkq0ko0">一个避免上述涉及问题的途径就是完全地移除我们组件中的 state。如果 email 地址只存在于 prop，那我们没必要担心 state 的冲突。我们甚至可以把  <code class="css-0">EmailInput</code>  缓存一个更加轻量的函数式的组件：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">EmailInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token property-access">onChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">这个途径简化了我们组件的实现，但是我们如果想存储草稿的时候，父组件还是需要手工完成这件事。(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/7154w1l551" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">点这看这种模式的例子</a>)</p><h2 id="推荐：带有-key-的完全不受控组件" class="css-fkwewv e18lclmb1">推荐：带有 key 的完全不受控组件</h2><p class="css-8qp1bw ezkq0ko0">另一个替代方案就是我们的组件完全的控制自己的 email state “草稿”。在此例子中，我们的组件依然可以接收一个来自于<em class="css-0">初始值</em>，但它将会忽略后面 prop 的改动：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">EmailInput</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">defaultEmail</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token function-variable function">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">为了能在不同的情境下重置值(如密码管理方案)，我们使用特殊的 React 属性  <code class="css-0">key</code> 。当  <code class="css-0">key</code>  改变时，React <a href="https://link.zhihu.com/?target=https%3A//reactjs.org/docs/reconciliation.html%23keys" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">将创建一个新的组件实例而不是更新现有的这个</a>。Keys 经常被用于动态 list，但在这里依然管用。在我们的案例中，我们能根据 user ID 在新用户被选中时重新创建 email 输入组件：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token operator">&lt;</span><span class="token maybe-class-name">EmailInput</span><span class="token plain"> defaultEmail</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">}</span><span class="token plain"> key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">每当 ID 改变时， <code class="css-0">EmailInput</code>  将会被重新创建，它的 state 将会用最新的  <code class="css-0">defaultEmail</code>  值重置。(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/6v1znlxyxn" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">点这里看这种模式的例子</a>)使用这种途径，你不需要为每一个输入组件加  <code class="css-0">key</code> 。也许在 from 中加一个  <code class="css-0">key</code>  会来得更好。每当 key 改变时，所有在 from 里的组件都会用一个新的 initialized state 来重新创建。</p><p class="css-8qp1bw ezkq0ko0">更多的案例中，这是一个处理需要被重置的 state 的最佳方式。
Note
虽然这貌似会很慢，在性能差异无关紧要的时候。当组件有很重的更新逻辑时候，使用一个 key ，忽略子树 diffing 甚至会更快。</p><h2 id="替代方案-1：使用-id-prop-重置不受控组件" class="css-fkwewv e18lclmb1">替代方案 1：使用 ID prop 重置不受控组件</h2><p class="css-8qp1bw ezkq0ko0">如果  <code class="css-0">key</code>  由于某些原因不能被使用(也许组件有昂贵的初始化代价)，一个可行但笨重的方案就是在  <code class="css-0">getDerivedStateFromProps</code>  中监听 “userID” 的改变：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">EmailInput</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain">    email</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">defaultEmail</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">    prevPropsUserID</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">userID</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">  </span><span class="token keyword">static</span><span class="token plain"> </span><span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token parameter punctuation">,</span><span class="token parameter"> state</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">    </span><span class="token comment">// Any time the current user changes,</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">    </span><span class="token comment">// Reset any parts of state that are tied to that user.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">    </span><span class="token comment">// In this simple example, that&#x27;s just the email.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token property-access">userID</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">prevPropsUserID</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">        prevPropsUserID</span><span class="token punctuation">:</span><span class="token plain"> props</span><span class="token punctuation">.</span><span class="token property-access">userID</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain">        email</span><span class="token punctuation">:</span><span class="token plain"> props</span><span class="token punctuation">.</span><span class="token property-access">defaultEmail</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">17</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">18</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">19</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">20</span><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">21</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">这也提供了灵活性——重置部分被我们选中的组件内部 state。(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/rjyvp7l3rq" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">点这里看此模式的 demo</a>)
Note
及时以上例子展示了  &gt; <code class="css-0">getDerivedStateFromProps</code> ，同样的技术手段也可以被用在  &gt; <code class="css-0">componentWillReceiveProps</code> 。</p><h2 id="替代方式-2：在一个实例方法中重置不受控组件" class="css-fkwewv e18lclmb1">替代方式 2：在一个实例方法中重置不受控组件</h2><p class="css-8qp1bw ezkq0ko0">更罕见地，你可能需要重置 state 即使没有适当的 ID 可用为  <code class="css-0">key</code> 。一个解决方案就是每次你想重置时用一个随机数或者自增数字重置 key。另一个可行的方案是暴露一个实例方法命令式的重置内部 state：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">EmailInput</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain">    email</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">defaultEmail</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">  </span><span class="token function">resetEmailForNewUser</span><span class="token punctuation">(</span><span class="token parameter">newEmail</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> email</span><span class="token punctuation">:</span><span class="token plain"> newEmail </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">父组件能<a href="https://link.zhihu.com/?target=https%3A//reactjs.org/docs/glossary.html%23refs" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">用 ref 来调用这个方法</a>。(<a href="https://link.zhihu.com/?target=https%3A//codesandbox.io/s/l70krvpykl" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">点击这看这个模式例子</a>)</p><p class="css-8qp1bw ezkq0ko0">Refs 在这个确定的例子中是有用的，但通常上我们建议你保守使用。甚至在这个 demo 中，这个必要的方法是不理想的，因为本来一次的渲染会变成两次。</p><hr class="css-xu77su e1yst2jy0"/><h2 id="扼要重述" class="css-fkwewv e18lclmb1">扼要重述</h2><p class="css-8qp1bw ezkq0ko0">重述一下，当设计一个组件的时候，决定数据是否受控或不受控是至关重要的。</p><p class="css-8qp1bw ezkq0ko0">让组件变得<strong class="css-0">受控</strong>，而不是试图在<strong class="css-0"> state 中复制一个 prop </strong>，在一些父组件的 state 中联合两个分散的值。举个例子，与其子组件接收一个“已提交的” <code class="css-0">props.value</code>  并跟踪一个“草稿” <code class="css-0">state.value</code> ，不如在父组件中管理  <code class="css-0">state.draftValue</code>  和  <code class="css-0">state.committedValue</code> ，并控制直接控制子组件的值。这让数据流更加明确和可预测。</p><p class="css-8qp1bw ezkq0ko0">对<strong class="css-0">不受控</strong>组件，如果你在一个特殊的 prop (通常是 ID)改变时试图重置 state，你有一些选择：</p><ul class="css-1rpojxi eouu7a70"><li class="css-0"><p class="css-8qp1bw ezkq0ko0"><strong class="css-0">推荐：重置所有内部 state，使用 key 属性</strong></p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">替代方案 1：<em class="css-0">仅重置确定的 state 字段</em>，监听特定属性的变化(例如： <code class="css-0">props.userID</code>)。</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">替代方案 2：你也可以考虑使用 refs 调用一个命令式实例方法。</p></li></ul><hr class="css-xu77su e1yst2jy0"/><h2 id="什么是-memoization-" class="css-fkwewv e18lclmb1">什么是 memoization ?</h2><p class="css-8qp1bw ezkq0ko0">我们也看到，仅当输入变化的时候，derived state 被用于确保关键值被用于  <code class="css-0">render</code>  中会重新计算。这个技巧被称之为  <a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Memoization" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">memoization</a>。</p><p class="css-8qp1bw ezkq0ko0">使用 derived state 来完成 memoization 并不一定是坏事，但这经常不是最佳方案。管理 derived state 具有内在复杂度，这个复杂度随着属性的增加而提升。例如，如果我们想要加入第二个 derived feild 到我们的组件 state，那么我们的实现将需要分别跟踪两者的变化。</p><p class="css-8qp1bw ezkq0ko0">让我们来看一个例子——组件携带一个属性(一个 item list)，并渲染匹配用户输入的搜索查询的 item。我们使用 derived state 存储过滤的 list：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Example</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain">    filterText</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">  </span><span class="token comment">// *******************************************************</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">  </span><span class="token comment">// NOTE: this example is NOT the recommended approach.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">  </span><span class="token comment">// See the examples below for our recommendations instead.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">  </span><span class="token comment">// *******************************************************</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain">  </span><span class="token keyword">static</span><span class="token plain"> </span><span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token parameter punctuation">,</span><span class="token parameter"> state</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain">    </span><span class="token comment">// Re-run the filter whenever the list array or filter text change.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">    </span><span class="token comment">// Note we need to store prevPropsList and prevFilterText to detect changes.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain">      props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">prevPropsList</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain">      state</span><span class="token punctuation">.</span><span class="token property-access">prevFilterText</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">17</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">18</span><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">19</span><span class="token plain">        prevPropsList</span><span class="token punctuation">:</span><span class="token plain"> props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">20</span><span class="token plain">        prevFilterText</span><span class="token punctuation">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">21</span><span class="token plain">        filteredList</span><span class="token punctuation">:</span><span class="token plain"> props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">22</span><span class="token plain">          item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">23</span><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">24</span><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">25</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">26</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">27</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">28</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">29</span><span class="token plain">  </span><span class="token function-variable function">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">30</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> filterText</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">31</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">32</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">33</span><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">34</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">35</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">36</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">37</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">38</span><span class="token plain">          </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filteredList</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">39</span><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token plain">li key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">li</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">40</span><span class="token plain">          </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">41</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">42</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">43</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">44</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">45</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">这个实现避免了不必要  <code class="css-0">filteredList</code>  的重新计算。但这比原来的更复杂，因为他必须分开跟踪和检测 props 和 state 的变化，才能正确更新过滤后的列表。在这个例子中，我们能使用  <code class="css-0">PureComponent</code>  简化工作，移动更新操作到 render 方法中：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token comment">// PureComponents only rerender if at least one state or prop value changes.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain"></span><span class="token comment">// Change is determined by doing a shallow comparison of state and prop keys.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Example</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">PureComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token comment">// State only needs to hold the current filter text value:</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain">    filterText</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">  </span><span class="token function-variable function">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> filterText</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain">    </span><span class="token comment">// The render method on this PureComponent is called only if</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain">    </span><span class="token comment">// props.list or state.filterText has changed.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> filteredList </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">17</span><span class="token plain">      item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">18</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">19</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">20</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">21</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">22</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">23</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">24</span><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain">filteredList</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">25</span><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token plain">li key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">li</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">26</span><span class="token plain">          </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">27</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">28</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">29</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">30</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">31</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">这种途径比用 derived state 更加清晰且简单。偶尔地，这不够好——在大列表中过滤会变得慢，如果其他 prop 变化时  <code class="css-0">PureComponent</code>  不会阻止重渲染。为了解决这些问题，我们可以加入一个 memoization helper 来避免对 list 的不必要过滤：</p><div style="overflow:auto"><pre class="prism-code language-javascript" style="position:relative"><button data-a11y="false" class="css-1chxjt6 eu6xrih0">Copy <svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#6f7177"></path></svg></button><div class="token-line"><span class="number-line">1</span><span class="token keyword module">import</span><span class="token plain"> memoize </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;memoize-one&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">2</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">3</span><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Example</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">4</span><span class="token plain">  </span><span class="token comment">// State only needs to hold the current filter text value:</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">5</span><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> filterText</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">6</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">7</span><span class="token plain">  </span><span class="token comment">// Re-run the filter whenever the list array or filter text changes:</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">8</span><span class="token plain">  filter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">memoize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token parameter punctuation">,</span><span class="token parameter"> filterText</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">9</span><span class="token plain">    list</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token plain">filterText</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">10</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">11</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">12</span><span class="token plain">  </span><span class="token function-variable function">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">13</span><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> filterText</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">14</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">15</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">16</span><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">17</span><span class="token plain">    </span><span class="token comment">// Calculate the latest filtered list. If these arguments haven&#x27;t changed</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">18</span><span class="token plain">    </span><span class="token comment">// since the last render, `memoize-one` will reuse the last return value.</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">19</span><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> filteredList </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">20</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">21</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">22</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">23</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">input onChange</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleChange</span><span class="token punctuation">}</span><span class="token plain"> value</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">filterText</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">24</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">25</span><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain">filteredList</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">26</span><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token plain">li key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">item</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">li</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">27</span><span class="token plain">          </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">28</span><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">29</span><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Fragment</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">30</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">31</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="number-line">32</span><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p class="css-8qp1bw ezkq0ko0">这更加简单，而且性能和 derived state 版本的一样好！</p><p class="css-8qp1bw ezkq0ko0">当使用 memoization 时，记住一些约束条件：</p><style data-emotion-css="1smg95t">.css-1smg95t{list-style:none;counter-reset:list;color:var(--theme-ui-colors-articleText,#08080B);position:relative;padding:15px 0 30px 30px;margin:0 auto;-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);font-size:18px;width:100%;max-width:680px;}@media (max-width:66.875em){.css-1smg95t{max-width:507px;}}@media (max-width:45.9375em){.css-1smg95t{max-width:486px;padding-left:0px;}}@media (max-width:33.75em){.css-1smg95t{padding-left:20px;}}.css-1smg95t li{position:relative;padding-bottom:15px;}@media (max-width:45.9375em){.css-1smg95t li{padding-left:30px;}}@media (max-width:33.75em){.css-1smg95t li{padding-left:30px;}}@media (max-width:45.9375em){.css-1smg95t li p{padding:0;}}.css-1smg95t li >:not(ol,ul){display:inline;}.css-1smg95t li::before{width:3rem;display:inline-block;position:absolute;color:var(--theme-ui-colors-articleText,#08080B);}.css-1smg95t li::before{counter-increment:list;content:counter(list) '.';font-weight:600;position:absolute;left:-3rem;top:-0.3rem;font-size:2rem;}@media (max-width:45.9375em){.css-1smg95t li::before{left:0;}}</style><ol class="css-1smg95t e37vq8s0"><li class="css-0"><p class="css-8qp1bw ezkq0ko0">在大多数案例中，你会想把 memoized 函数附加到组件实例上。这防止一个组件的多个实例重置彼此的 memoized key。</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">通常地，你会想使用一个具有缓存大小限制的 memoization helper 来避免内存泄露问题。（在以上的例子中，我们用了  <code class="css-0">memoize-one</code>  因为它仅缓存最近的参数和结果。）</p></li><li class="css-0"><p class="css-8qp1bw ezkq0ko0">如果  <code class="css-0">props.list</code>  在每次父组件渲染时被重新创建，本节中展示的实现手段是无法工作的。但在多数案例中，这种设置是适当的。</p></li></ol><hr class="css-xu77su e1yst2jy0"/><h2 id="结语" class="css-fkwewv e18lclmb1">结语</h2><p class="css-8qp1bw ezkq0ko0">在实际的应用中，组件经常包含受控和不受控行为的混合。这是没问题的！如果每一个值都有清晰的真实源，你可以避免上面提及的反模式。</p><p class="css-8qp1bw ezkq0ko0">同样值得重申的是， <code class="css-0">getDerivedStateFromProps</code> (一般的 derived state) 是一个高级特性，由于其复杂度，应该保守的使用它。如果你使用的案例超出这些模式，请在  <a href="https://link.zhihu.com/?target=https%3A//github.com/reactjs/reactjs.org/issues/new" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">Github</a>  或  <a href="https://link.zhihu.com/?target=https%3A//twitter.com/reactjs" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">Twitter</a>  上与我们分享！</p><p class="css-8qp1bw ezkq0ko0">原文链接：<a href="https://link.zhihu.com/?target=https%3A//reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="noreferrer" class="css-mckguv e116srhk0">You Probably Don’t Need Derived State - React Blog</a></p><style data-emotion-css="akmrme animation-1xhp7f5">.css-akmrme{position:absolute;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:1;width:225px;height:46px;padding:7px 11px 7px 19px;color:var(--theme-ui-colors-grey,#73737D);background:#000;border-radius:5px;font-size:18px;font-weight:600;-webkit-transition:left 75ms ease-out,right 75ms ease-out,background 200ms;transition:left 75ms ease-out,right 75ms ease-out,background 200ms;-webkit-animation:animation-1xhp7f5 200ms forwards;animation:animation-1xhp7f5 200ms forwards;}.css-akmrme::after{content:'';position:absolute;left:0;right:0;margin:0 auto;bottom:-8px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #000;-webkit-transition:border-color 200ms;transition:border-color 200ms;}.css-akmrme svg path{fill:#fff;}@-webkit-keyframes animation-1xhp7f5{0%{-webkit-transform:matrix(.97,0,0,1,0,12);-ms-transform:matrix(.97,0,0,1,0,12);transform:matrix(.97,0,0,1,0,12);opacity:0;}20%{-webkit-transform:matrix(.99,0,0,1,0,2);-ms-transform:matrix(.99,0,0,1,0,2);transform:matrix(.99,0,0,1,0,2);opacity:.7;}40%{-webkit-transform:matrix(1,0,0,1,0,-1);-ms-transform:matrix(1,0,0,1,0,-1);transform:matrix(1,0,0,1,0,-1);opacity:1;}70%{-webkit-transform:matrix(1,0,0,1,0,0);-ms-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);opacity:1;}100%{-webkit-transform:matrix(1,0,0,1,0,0);-ms-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);opacity:1;}}@keyframes animation-1xhp7f5{0%{-webkit-transform:matrix(.97,0,0,1,0,12);-ms-transform:matrix(.97,0,0,1,0,12);transform:matrix(.97,0,0,1,0,12);opacity:0;}20%{-webkit-transform:matrix(.99,0,0,1,0,2);-ms-transform:matrix(.99,0,0,1,0,2);transform:matrix(.99,0,0,1,0,2);opacity:.7;}40%{-webkit-transform:matrix(1,0,0,1,0,-1);-ms-transform:matrix(1,0,0,1,0,-1);transform:matrix(1,0,0,1,0,-1);opacity:1;}70%{-webkit-transform:matrix(1,0,0,1,0,0);-ms-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);opacity:1;}100%{-webkit-transform:matrix(1,0,0,1,0,0);-ms-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);opacity:1;}}</style><div style="position:absolute;left:0px;top:0px;display:none;pointer-events:none" class="css-akmrme exucw410"><style data-emotion-css="12z0wuy">.css-12z0wuy{margin-right:8px;}</style><span class="css-12z0wuy exucw411">Share: </span><style data-emotion-css="pd22cz">.css-pd22cz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 11px;cursor:pointer;}</style><a class="css-pd22cz exucw413"><style data-emotion-css="18l3o48">.css-18l3o48{width:0px;height:0px;visibility:hidden;opacity:0;}</style><div class="css-18l3o48 exucw412">Share the selected text</div><svg width="18px" height="15px" viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z" fill="white"></path></svg></a><a class="css-pd22cz exucw413"><div class="css-18l3o48 exucw412">Share the selected text</div><svg width="16px" height="16px" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z" fill="white"></path></svg></a><style data-emotion-css="1lnhvdd">.css-1lnhvdd{display:inline-block;height:17px;width:1px;position:relative;margin:0 8px;background:rgba(115,115,125,0.3);}</style><div class="css-1lnhvdd exucw415"></div><style data-emotion-css="15hjez6">.css-15hjez6{display:inline-block;padding:16px 11px;}</style><button aria-label="Copy selected text" class="css-15hjez6 exucw414"><svg width="15" height="19" viewBox="0 0 15 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0475 0.905273H1.67197C0.812542 0.905273 0.109375 1.60844 0.109375 2.46787V13.406H1.67197V2.46787H11.0475V0.905273ZM13.3914 4.03046H4.79716C3.93773 4.03046 3.23456 4.73363 3.23456 5.59306V16.5312C3.23456 17.3906 3.93773 18.0938 4.79716 18.0938H13.3914C14.2509 18.0938 14.954 17.3906 14.954 16.5312V5.59306C14.954 4.73363 14.2509 4.03046 13.3914 4.03046ZM13.3914 16.5312H4.79716V5.59306H13.3914V16.5312Z" fill="#08080B"></path></svg></button></div></div></article><style data-emotion-css="4j05o4">.css-4j05o4{width:100%;max-width:1220px;margin:0 auto;padding:0 4rem;}@media (max-width:66.875em){.css-4j05o4{max-width:850px;}}@media (max-width:45.9375em){.css-4j05o4{padding:0 2rem;max-width:527px;}}@media (max-width:33.75em){.css-4j05o4{max-width:100%;}}</style><section class="css-4j05o4 e9w9r0m0"><style data-emotion-css="onisl3">.css-onisl3{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:64px 0 55px;margin:10px auto 100px;background:var(--theme-ui-colors-card,#fff);box-shadow:0px 4px 50px rgba(0,0,0,0.05);z-index:1;}@media (max-width:45.9375em){.css-onisl3{padding:50px 0 0;text-align:center;}}@media (max-width:33.75em){.css-onisl3{margin:-20px auto 80px;}}</style><div class="css-onisl3 e9rlixp0"><style data-emotion-css="1oqvt8d">.css-1oqvt8d{margin:0 auto;width:100%;max-width:640px;}@media (max-width:45.9375em){.css-1oqvt8d h3{padding:0 50px;}}@media (max-width:23.5em){.css-1oqvt8d h3{padding:0 24px;}}</style><div class="css-1oqvt8d e9rlixp1"><style data-emotion-css="1x3fveg">.css-1x3fveg{word-break:keep-all;font-size:24px;line-height:1.45;font-weight:bold;color:var(--theme-ui-colors-primary,#000);font-family:'Merriweather',Georgia,Serif;margin-bottom:20px;}@media (max-width:45.9375em){.css-1x3fveg{font-size:22px;}}@media (max-width:33.75em){.css-1x3fveg{font-size:20px;}}@media (max-width:45.9375em){.css-1x3fveg{margin-bottom:15px;}}</style><h3 class="css-1x3fveg e9rlixp2">Join our email list and get notified about new content</h3><style data-emotion-css="cc9et1">.css-cc9et1{margin:0 auto 30px;color:var(--theme-ui-colors-grey,#73737D);line-height:1.75;}@media (max-width:45.9375em){.css-cc9et1{padding:0 26px;margin:0 auto 25px;}}</style><p class="css-cc9et1 e9rlixp3">Be the first to receive our latest content with the ability to opt-out at anytime. We promise to not spam your inbox or share your email with any third parties.</p><style data-emotion-css="1abwf50">.css-1abwf50{position:relative;}.css-1abwf50::after{content:">";position:absolute;left:21px;top:10px;color:var(--theme-ui-colors-accent,#6166DC);}@media (max-width:45.9375em){.css-1abwf50::after{left:34px;top:11px;}}</style><form class="css-1abwf50 e9rlixp4"><style data-emotion-css="qd44q7">.css-qd44q7{position:relative;background:var(--theme-ui-colors-inputBackground,rgba(0,0,0,0.05));border-radius:35px;border:none;padding:13px 21px 13px 35px;width:471px;color:var(--theme-ui-colors-primary,#000);}.css-qd44q7::-webkit-input-placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));opacity:1;}.css-qd44q7::-moz-placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));opacity:1;}.css-qd44q7:-ms-input-placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));opacity:1;}.css-qd44q7::placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));opacity:1;}.css-qd44q7:-ms-input-placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));}.css-qd44q7::-ms-input-placeholder{color:var(--theme-ui-colors-track,rgba(8,8,11,0.3));}@media (max-width:45.9375em){.css-qd44q7{width:calc(100% - 36px);margin:0 18px;padding:14px 14px 14px 30px;margin-bottom:30px;}}</style><input type="email" placeholder="your@email.com" name="email" value="" class="css-qd44q7 e9rlixp5"/><style data-emotion-css="elvgax">.css-elvgax{position:absolute;left:306px;top:3px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:161px;height:38px;border:1px solid var(--theme-ui-colors-accent,#6166DC);color:var(--theme-ui-colors-accent,#6166DC);background:transparent;font-weight:600;border-radius:35px;-webkit-letter-spacing:0.42px;-moz-letter-spacing:0.42px;-ms-letter-spacing:0.42px;letter-spacing:0.42px;-webkit-transition:border-color 0.2s var(--ease-in-out-quad),background 0.2s var(--ease-in-out-quad),color 0.2s var(--ease-in-out-quad);transition:border-color 0.2s var(--ease-in-out-quad),background 0.2s var(--ease-in-out-quad),color 0.2s var(--ease-in-out-quad);}.css-elvgax:hover{background:var(--theme-ui-colors-accent,#6166DC);color:var(--theme-ui-colors-background,#fafafa);}.css-elvgax[disabled]{cursor:not-allowed;}.css-elvgax svg *{fill:var(--theme-ui-colors-background,#fafafa);}@media (max-width:45.9375em){.css-elvgax{position:relative;height:60px;width:100%;top:0;left:0;border:none;border-radius:0;border-top:1px solid var(--theme-ui-colors-horizontalRule,rgba(8,8,11,0.15));}.css-elvgax:hover{color:initial;background:initial;}}</style><button type="submit" class="css-elvgax e9rlixp6">Subscribe</button></form></div></div></section><style data-emotion-css="npfbur">.css-npfbur{width:100%;max-width:1220px;margin:0 auto;padding:0 4rem;display:block;}@media (max-width:66.875em){.css-npfbur{max-width:850px;}}@media (max-width:45.9375em){.css-npfbur{padding:0 2rem;max-width:527px;}}@media (max-width:33.75em){.css-npfbur{max-width:100%;}}</style><section class="css-npfbur eih7p4r2"><style data-emotion-css="1vgsxfa">.css-1vgsxfa{position:relative;opacity:0.25;margin-bottom:100px;font-weight:400;color:var(--theme-ui-colors-primary,#000);}@media (max-width:45.9375em){.css-1vgsxfa{margin-bottom:60px;}}.css-1vgsxfa::after{content:'';position:absolute;background:var(--theme-ui-colors-grey,#73737D);width:79.82456140350878%;height:1px;right:0;top:11px;}@media (max-width:45.9375em){.css-1vgsxfa::after{width:52.63157894736842%;}}@media (max-width:33.75em){.css-1vgsxfa::after{width:35.08771929824561%;}}@media (max-width:23.5em){.css-1vgsxfa::after{width:90px;}}</style><h3 class="css-1vgsxfa eih7p4r3">More articles from <!-- -->Edward Elric</h3><style data-emotion-css="80jzpj">.css-80jzpj{position:relative;display:grid;grid-template-columns:1fr 457px;grid-template-rows:2;-webkit-column-gap:30px;column-gap:30px;margin:0 auto;max-width:100%;}@media (max-width:66.875em){.css-80jzpj{grid-template-columns:1fr 1fr;}}@media (max-width:45.9375em){.css-80jzpj{grid-template-columns:1fr;}}</style><div class="css-80jzpj e1o8vm2h0"><style data-emotion-css="16a98w2">.css-16a98w2{position:relative;display:block;width:100%;height:100%;top:0;left:0;z-index:1;-webkit-transition:-webkit-transform 0.33s var(--ease-out-quart);-webkit-transition:transform 0.33s var(--ease-out-quart);transition:transform 0.33s var(--ease-out-quart);-webkit-tap-highlight-color:rgba(255,255,255,0);}.css-16a98w2:hover .e1o8vm2h1{-webkit-transform:translateY(-1px);-ms-transform:translateY(-1px);transform:translateY(-1px);box-shadow:0 50px 80px -20px rgba(0,0,0,0.27),0 30px 50px -30px rgba(0,0,0,0.3);}.css-16a98w2:hover h2,.css-16a98w2:focus h2{color:var(--theme-ui-colors-accent,#6166DC);}.css-16a98w2[data-a11y="true"]:focus::after{content:"";position:absolute;left:-2%;top:-2%;width:104%;height:104%;border:3px solid var(--theme-ui-colors-accent,#6166DC);background:rgba(255,255,255,0.01);}@media (max-width:33.75em){.css-16a98w2:hover .e1o8vm2h1{-webkit-transform:none;-ms-transform:none;transform:none;box-shadow:initial;}.css-16a98w2:active{-webkit-transform:scale(0.97) translateY(3px);-ms-transform:scale(0.97) translateY(3px);transform:scale(0.97) translateY(3px);}}</style><a data-a11y="false" narrow="false" class="css-16a98w2 e1o8vm2h6" href="/react-official-sample-explanation"><style data-emotion-css="1g2qwvh">.css-1g2qwvh{position:relative;}@media (max-width:540px){.css-1g2qwvh{box-shadow:0px 20px 40px rgba(0,0,0,0.2);border-bottom-right-radius:5px;border-bottom-left-radius:5px;background:var(--theme-ui-colors-card,#fff);}}</style><div class="css-1g2qwvh e1o8vm2h2"><style data-emotion-css="f56zxy">.css-f56zxy{position:relative;height:280px;box-shadow:0 30px 60px -10px rgba(0,0,0,0.3),0 18px 36px -18px rgba(0,0,0,0.33);margin-bottom:30px;-webkit-transition:-webkit-transform 0.3s var(--ease-out-quad),box-shadow 0.3s var(--ease-out-quad);-webkit-transition:transform 0.3s var(--ease-out-quad),box-shadow 0.3s var(--ease-out-quad);transition:transform 0.3s var(--ease-out-quad),box-shadow 0.3s var(--ease-out-quad);}.css-f56zxy > div{height:100%;}@media (max-width:45.9375em){.css-f56zxy{height:220px;margin-bottom:35px;}}@media (max-width:33.75em){.css-f56zxy{height:200px;margin-bottom:0;box-shadow:none;overflow:hidden;border-top-right-radius:5px;border-top-left-radius:5px;}}</style><div class="css-f56zxy e1o8vm2h1"><div class="css-133qvua e13158qv0 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:36.19631901840491%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABJ0lEQVQoz22QTU7DMBCFcxRCW8eO7cRx3PzS0EWFkJBgAUJi2SNwCS7BDbgH53rMWElpBYunGXvmfXlOcp2VEGEHrulaY6McsryC1B6CemUCBPVX82ydFXEv3Zi4Y8oGuQ2QxmMlLJJM18hUhVjJHOuZBM02ZBYEEvOeNPMs9xfiu0Qaps+Ky+F3mQDKjwjPR7j7F+TNHpLuddkiL5q4q+wWxnVRfE7O0ywwNvhmgqsH+PYW7cMrhsc3hN0dQjshdHuU9Qhb9SfQ8pHLhDNQ0aDwPcrthGo8wPoBlv6TJZMLNzSjM4EWKHsY9ge4pJT0jFUq0R3f8fT1jcPHJ1SYoOnJBSU3BGYop2Ig9yxO+2/CU1LXQ1NK/o+GDVT1nIzTMIArQ1nc/wA+B9vhhfbsPgAAAABJRU5ErkJggg==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/5c28025533d676f6b16aba38e733b9da/ac59e/react.webp 163w,
/static/5c28025533d676f6b16aba38e733b9da/7660b/react.webp 327w,
/static/5c28025533d676f6b16aba38e733b9da/0acdf/react.webp 653w,
/static/5c28025533d676f6b16aba38e733b9da/75470/react.webp 980w,
/static/5c28025533d676f6b16aba38e733b9da/68d47/react.webp 1306w,
/static/5c28025533d676f6b16aba38e733b9da/c8c0f/react.webp 1321w" sizes="(max-width: 653px) 100vw, 653px" /><source srcset="/static/5c28025533d676f6b16aba38e733b9da/078a8/react.png 163w,
/static/5c28025533d676f6b16aba38e733b9da/e56da/react.png 327w,
/static/5c28025533d676f6b16aba38e733b9da/3ddd4/react.png 653w,
/static/5c28025533d676f6b16aba38e733b9da/c5cc7/react.png 980w,
/static/5c28025533d676f6b16aba38e733b9da/eebd2/react.png 1306w,
/static/5c28025533d676f6b16aba38e733b9da/d9460/react.png 1321w" sizes="(max-width: 653px) 100vw, 653px" /><img loading="lazy" sizes="(max-width: 653px) 100vw, 653px" srcset="/static/5c28025533d676f6b16aba38e733b9da/078a8/react.png 163w,
/static/5c28025533d676f6b16aba38e733b9da/e56da/react.png 327w,
/static/5c28025533d676f6b16aba38e733b9da/3ddd4/react.png 653w,
/static/5c28025533d676f6b16aba38e733b9da/c5cc7/react.png 980w,
/static/5c28025533d676f6b16aba38e733b9da/eebd2/react.png 1306w,
/static/5c28025533d676f6b16aba38e733b9da/d9460/react.png 1321w" src="/static/5c28025533d676f6b16aba38e733b9da/3ddd4/react.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><style data-emotion-css="1iwkho8">.css-1iwkho8{word-break:keep-all;font-size:24px;line-height:1.45;font-weight:bold;color:var(--theme-ui-colors-primary,#000);font-family:'Merriweather',Georgia,Serif;font-size:22px;line-height:1.4;margin-bottom:10px;color:var(--theme-ui-colors-primary,#000);font-family:'Merriweather',Georgia,Serif;-webkit-transition:color 0.3s ease-in-out;transition:color 0.3s ease-in-out;text-overflow:ellipsis;overflow-wrap:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;display:-webkit-box;white-space:normal;overflow:hidden;}@media (max-width:45.9375em){.css-1iwkho8{font-size:22px;}}@media (max-width:33.75em){.css-1iwkho8{font-size:20px;}}@media (max-width:33.75em){.css-1iwkho8{-webkit-line-clamp:3;}}@media (max-width:45.9375em){.css-1iwkho8{margin-bottom:15px;}}@media (max-width:33.75em){.css-1iwkho8{padding:30px 20px 0;margin-bottom:10px;-webkit-line-clamp:3;}}</style><h3 class="css-1iwkho8 e1o8vm2h3">React 官網示例講解</h3><style data-emotion-css="1rec7sy">.css-1rec7sy{text-overflow:ellipsis;overflow-wrap:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;display:-webkit-box;white-space:normal;overflow:hidden;font-size:16px;margin-bottom:10px;color:var(--theme-ui-colors-grey,#73737D);display:box;max-width:515px;}@media (max-width:33.75em){.css-1rec7sy{-webkit-line-clamp:3;}}@media (max-width:66.875em){.css-1rec7sy{display:-webkit-box;}}@media (max-width:45.9375em){.css-1rec7sy{margin-bottom:15px;}}@media (max-width:33.75em){.css-1rec7sy{max-width:100%;padding:0 20px;margin-bottom:20px;-webkit-line-clamp:3;}}</style><p class="css-1rec7sy e1o8vm2h4">前言 可能大家會問：“官網示例那麼簡單，有必要講解嗎？”，我的看法是：“非常需要！”。一般而言，官方文檔是學習新知識最好的去處，你可以瞭解它的理念、思想、模式和 API 等等，可謂是無所不包。相對來說，官網的 Sample…</p><style data-emotion-css="118hiy6">.css-118hiy6{font-weight:600;font-size:16px;color:var(--theme-ui-colors-grey,#73737D);opacity:0.33;}@media (max-width:33.75em){.css-118hiy6{max-width:100%;padding:0 20px 30px;}}</style><div class="css-118hiy6 e1o8vm2h5">March 1st, 2016<!-- --> · <!-- -->1<!-- --> min read</div> </div></a><style data-emotion-css="1f0c0jf">.css-1f0c0jf{position:relative;display:block;width:100%;height:100%;top:0;left:0;z-index:1;-webkit-transition:-webkit-transform 0.33s var(--ease-out-quart);-webkit-transition:transform 0.33s var(--ease-out-quart);transition:transform 0.33s var(--ease-out-quart);-webkit-tap-highlight-color:rgba(255,255,255,0);}.css-1f0c0jf:hover .e1o8vm2h1{-webkit-transform:translateY(-1px);-ms-transform:translateY(-1px);transform:translateY(-1px);box-shadow:0 50px 80px -20px rgba(0,0,0,0.27),0 30px 50px -30px rgba(0,0,0,0.3);}.css-1f0c0jf:hover h2,.css-1f0c0jf:focus h2{color:var(--theme-ui-colors-accent,#6166DC);}.css-1f0c0jf[data-a11y="true"]:focus::after{content:"";position:absolute;left:-2%;top:-2%;width:104%;height:104%;border:3px solid var(--theme-ui-colors-accent,#6166DC);background:rgba(255,255,255,0.01);}@media (max-width:45.9375em){.css-1f0c0jf{display:none;}}@media (max-width:33.75em){.css-1f0c0jf:hover .e1o8vm2h1{-webkit-transform:none;-ms-transform:none;transform:none;box-shadow:initial;}.css-1f0c0jf:active{-webkit-transform:scale(0.97) translateY(3px);-ms-transform:scale(0.97) translateY(3px);transform:scale(0.97) translateY(3px);}}</style><a data-a11y="false" narrow="true" class="css-1f0c0jf e1o8vm2h6" href="/interview-in-guangzhou-2016"><div class="css-1g2qwvh e1o8vm2h2"><div class="css-f56zxy e1o8vm2h1"><div class="css-133qvua e13158qv0 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:60.526315789473685%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAGd86g0YzhD/8QAGRABAQEAAwAAAAAAAAAAAAAAAQACERIh/9oACAEBAAEFAuJxdbO0nSy+/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAwEBPwGH/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/Abqv/8QAFhAAAwAAAAAAAAAAAAAAAAAAARAg/9oACAEBAAY/AoC//8QAGhAAAgMBAQAAAAAAAAAAAAAAAAERITFhcf/aAAgBAQABPyFdlA0nUYTH148Jh//aAAwDAQACAAMAAAAQ8N//xAAXEQADAQAAAAAAAAAAAAAAAAAAATFR/9oACAEDAQE/EIg2sP/EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxCybf/EABwQAQADAAIDAAAAAAAAAAAAAAEAESExQWGBkf/aAAgBAQABPxAlTpXuC2vJxH0gD4Ddm471dquNYgqbP//Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/31fce/guangzhou.webp 114w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/e3e25/guangzhou.webp 229w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/15384/guangzhou.webp 457w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/0258d/guangzhou.webp 686w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/9754a/guangzhou.webp 720w" sizes="(max-width: 457px) 100vw, 457px" /><source srcset="/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/5a3ee/guangzhou.jpg 114w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/41f8f/guangzhou.jpg 229w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/eaa58/guangzhou.jpg 457w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/c309b/guangzhou.jpg 686w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/94285/guangzhou.jpg 720w" sizes="(max-width: 457px) 100vw, 457px" /><img loading="lazy" sizes="(max-width: 457px) 100vw, 457px" srcset="/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/5a3ee/guangzhou.jpg 114w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/41f8f/guangzhou.jpg 229w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/eaa58/guangzhou.jpg 457w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/c309b/guangzhou.jpg 686w,
/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/94285/guangzhou.jpg 720w" src="/static/0a9e1ac3baac5020b3dfdc1c61c0fa3b/eaa58/guangzhou.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><h3 class="css-1iwkho8 e1o8vm2h3">2016 年廣州前端面試之旅</h3><p class="css-1rec7sy e1o8vm2h4">2015 年過去的好快，在荔枝 FM 帶了好像沒有多久的時間，其實也不算短，將近一年了。 我在知乎上改了簽名：“2015 过去了，2016 又会怎么样……”，其實對 2016 年還是蠻忐忑的，因為有計畫想要換一份新的工作，但是覺得自己水平還不夠強。 說說在荔枝 FM…</p><div class="css-118hiy6 e1o8vm2h5">February 27th, 2016<!-- --> · <!-- -->1<!-- --> min read</div> </div></a></div><style data-emotion-css="1xyudza">.css-1xyudza{margin-bottom:65px;}</style><div class="css-1xyudza eih7p4r4"></div></section><style data-emotion-css="1hk9het">.css-1hk9het{position:absolute;bottom:0;left:0;width:100%;height:590px;z-index:0;pointer-events:none;background:var(--theme-ui-colors-gradient,linear-gradient(180deg,rgba(217,219,224,0) 0%,#D9DBE0 100%));-webkit-transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);transition:background 0.25s var(--ease-in-out-quad),color 0.25s var(--ease-in-out-quad);}</style><div class="css-1hk9het e9nvoze3"></div><section class="css-4j05o4 e9w9r0m0"><style data-emotion-css="1nedy0r">.css-1nedy0r{position:relative;margin:140px auto 50px;border-bottom:1px solid var(--theme-ui-colors-horizontalRule,rgba(8,8,11,0.15));}@media (max-width:45.9375em){.css-1nedy0r{margin:60px auto;}}@media (max-width:33.75em){.css-1nedy0r{display:none;}}</style><div class="css-1nedy0r e9nvoze1"></div><style data-emotion-css="1d54ci6">.css-1d54ci6{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding-bottom:80px;color:var(--theme-ui-colors-grey,#73737D);}@media (max-width:45.9375em){.css-1d54ci6{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-bottom:100px;}}@media (max-width:33.75em){.css-1d54ci6{padding-bottom:50px;}}</style><div class="css-1d54ci6 e9nvoze0"><style data-emotion-css="1pt7hv6">@media (max-width:45.9375em){.css-1pt7hv6{margin-bottom:80px;}}@media (max-width:33.75em){.css-1pt7hv6{margin:120px auto 100px;}}</style><div class="css-1pt7hv6 e9nvoze2">© <!-- -->2015–2020<!-- --> <!-- -->Edward Elric</div><div><style data-emotion-css="10tgu6b">.css-10tgu6b{position:relative;margin-left:3.2rem;-webkit-text-decoration:none;text-decoration:none;max-width:16px;}.css-10tgu6b:hover svg:hover *{fill:var(--theme-ui-colors-primary,#000);}.css-10tgu6b:hover svg *{-webkit-transition:fill 0.25s var(--ease-in-out-quad);transition:fill 0.25s var(--ease-in-out-quad);}.css-10tgu6b:first-of-type{margin-left:0;}.css-10tgu6b:last-child{margin-right:0;}.css-10tgu6b[data-a11y='true']:focus::after{content:'';position:absolute;left:-50%;top:-20%;width:200%;height:160%;border:2px solid var(--theme-ui-colors-accent,#6166DC);background:rgba(255,255,255,0.01);border-radius:5px;}@media (max-width:45.9375em){.css-10tgu6b{margin:0 2.2rem;}}</style><a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://twitter.com/sasuke688848" href="https://twitter.com/sasuke688848" class="css-10tgu6b e1dx16qw0"><svg width="16" height="13" viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z" fill="#73737D"></path></svg><style data-emotion-css="mglztx">.css-mglztx{width:0px;height:0px;visibility:hidden;opacity:0;overflow:hidden;display:inline-block;}</style><span class="css-mglztx e1dx16qw1">Link to $<!-- -->https://twitter.com/sasuke688848</span></a><a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://github.com/sasuke40" href="https://github.com/sasuke40" class="css-10tgu6b e1dx16qw0"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z" fill="#73737D"></path></svg><span class="css-mglztx e1dx16qw1">Link to $<!-- -->https://github.com/sasuke40</span></a><a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://www.linkedin.com/in/sasuke/" href="https://www.linkedin.com/in/sasuke/" class="css-10tgu6b e1dx16qw0"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z" fill="#73737D"></path></svg><span class="css-mglztx e1dx16qw1">Link to $<!-- -->https://www.linkedin.com/in/sasuke/</span></a></div></div></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-46826341-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/you-may-dont-need-drevied-state";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0c78b46b7aab204776e7.js"],"app":["/app-999d510888aa9729ca86.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-c9875e2473a7c518755f.js"],"component---node-modules-narative-gatsby-theme-novela-src-templates-article-template-tsx":["/component---node-modules-narative-gatsby-theme-novela-src-templates-article-template-tsx-aeb6e8ffda4b46761019.js"],"component---node-modules-narative-gatsby-theme-novela-src-templates-articles-template-tsx":["/component---node-modules-narative-gatsby-theme-novela-src-templates-articles-template-tsx-9f6a94b60ca18519d1ad.js"],"component---node-modules-narative-gatsby-theme-novela-src-templates-author-template-tsx":["/component---node-modules-narative-gatsby-theme-novela-src-templates-author-template-tsx-abb826c440c0d690f0b2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-d8821c8fb7dd4bb060f3.js"]};/*]]>*/</script><script src="/polyfill-0c78b46b7aab204776e7.js" nomodule=""></script><script src="/component---node-modules-narative-gatsby-theme-novela-src-templates-article-template-tsx-aeb6e8ffda4b46761019.js" async=""></script><script src="/f7f859cd4bf156c2acc6f46f65ba39cb35d4c0a9-5e5598041298502b7a9c.js" async=""></script><script src="/22df2c6f0e0b02f286186edbe62a3193fb639611-7c41ec640e6ee50925fa.js" async=""></script><script src="/044b48a8-21ca9a5926eae6d84c26.js" async=""></script><script src="/styles-c2fe8482057191dca484.js" async=""></script><script src="/app-999d510888aa9729ca86.js" async=""></script><script src="/framework-781d8c3da2b97ab386a4.js" async=""></script><script src="/webpack-runtime-700df7a2a709dc6130bc.js" async=""></script></body></html>