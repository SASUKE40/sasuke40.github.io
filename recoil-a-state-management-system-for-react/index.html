<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><style data-href="/styles.c65501306a59d5050c59.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #4cb4e7}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #4cb4e7}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--bg-secondary:#f9fafb;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a;--form-shadow:0 2px 15px 0 rgba(210,214,220,0.5)}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--bg-secondary:#363c48;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:rgba(115,124,153,0.2);--inlineCode-text:#ffee93;--form-shadow:0 2px 15px 0 rgba(26,26,27,0.637)}body:lang(ar) article,body:lang(fa) article,body:lang(he) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre,body:lang(he) .language-text,body:lang(he) article .translations,body:lang(he) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text,body:lang(he) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote,body:lang(he) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.friends{margin:1rem 0 2rem}.friend-card{margin:1rem 0;display:flex;-webkit-text-decoration-color:transparent;text-decoration-color:transparent;align-items:center;justify-content:start;cursor:pointer}.friend-card-content{padding-left:1rem}</style><meta name="generator" content="Gatsby 2.21.33"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=db981422b69d5b8b6449c95a925f031c"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=db981422b69d5b8b6449c95a925f031c"/><style id="jss-server-side">.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;-webkit-transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.MuiSvgIcon-colorPrimary{color:#3f51b5}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}.MuiPaper-root{color:rgba(0,0,0,.87);-webkit-transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-outlined{border:1px solid rgba(0,0,0,.12)}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}.MuiButtonBase-root{color:inherit;border:0;cursor:pointer;margin:0;display:-webkit-inline-box;display:inline-flex;outline:0;padding:0;position:relative;-webkit-box-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;-webkit-box-pack:center;justify-content:center;text-decoration:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiButtonBase-root::-moz-focus-inner{border-style:none}.MuiButtonBase-root.Mui-disabled{cursor:default;pointer-events:none}@media print{.MuiButtonBase-root{-webkit-print-color-adjust:exact;color-adjust:exact}}.MuiIconButton-root{-webkit-box-flex:0;flex:0 0 auto;color:rgba(0,0,0,.54);padding:12px;overflow:visible;font-size:1.5rem;text-align:center;-webkit-transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;border-radius:50%}.MuiIconButton-root:hover{background-color:rgba(0,0,0,.04)}.MuiIconButton-root.Mui-disabled{color:rgba(0,0,0,.26);background-color:transparent}@media (hover:none){.MuiIconButton-root:hover{background-color:transparent}}.MuiIconButton-edgeStart{margin-left:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeStart{margin-left:-3px}.MuiIconButton-edgeEnd{margin-right:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeEnd{margin-right:-3px}.MuiIconButton-colorInherit{color:inherit}.MuiIconButton-colorPrimary{color:#3f51b5}.MuiIconButton-colorPrimary:hover{background-color:rgba(63,81,181,.04)}@media (hover:none){.MuiIconButton-colorPrimary:hover{background-color:transparent}}.MuiIconButton-colorSecondary{color:#f50057}.MuiIconButton-colorSecondary:hover{background-color:rgba(245,0,87,.04)}@media (hover:none){.MuiIconButton-colorSecondary:hover{background-color:transparent}}.MuiIconButton-sizeSmall{padding:3px;font-size:1.125rem}.MuiIconButton-label{width:100%;display:-webkit-box;display:flex;-webkit-box-align:inherit;align-items:inherit;-webkit-box-pack:inherit;justify-content:inherit}.MuiSnackbar-root{left:8px;right:8px;display:-webkit-box;display:flex;z-index:1400;position:fixed;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}.MuiSnackbar-anchorOriginTopCenter{top:8px}@media (min-width:600px){.MuiSnackbar-anchorOriginTopCenter{top:24px;left:50%;right:auto;-webkit-transform:translateX(-50%);transform:translateX(-50%)}}.MuiSnackbar-anchorOriginBottomCenter{bottom:8px}@media (min-width:600px){.MuiSnackbar-anchorOriginBottomCenter{left:50%;right:auto;bottom:24px;-webkit-transform:translateX(-50%);transform:translateX(-50%)}}.MuiSnackbar-anchorOriginTopRight{top:8px;-webkit-box-pack:end;justify-content:flex-end}@media (min-width:600px){.MuiSnackbar-anchorOriginTopRight{top:24px;left:auto;right:24px}}.MuiSnackbar-anchorOriginBottomRight{bottom:8px;-webkit-box-pack:end;justify-content:flex-end}@media (min-width:600px){.MuiSnackbar-anchorOriginBottomRight{left:auto;right:24px;bottom:24px}}.MuiSnackbar-anchorOriginTopLeft{top:8px;-webkit-box-pack:start;justify-content:flex-start}@media (min-width:600px){.MuiSnackbar-anchorOriginTopLeft{top:24px;left:24px;right:auto}}.MuiSnackbar-anchorOriginBottomLeft{bottom:8px;-webkit-box-pack:start;justify-content:flex-start}@media (min-width:600px){.MuiSnackbar-anchorOriginBottomLeft{left:24px;right:auto;bottom:24px}}.MuiAlert-root{display:-webkit-box;display:flex;padding:6px 16px;font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;border-radius:4px;letter-spacing:.01071em;background-color:transparent}.MuiAlert-standardSuccess{color:#1e4620;background-color:#edf7ed}.MuiAlert-standardSuccess .MuiAlert-icon{color:#4caf50}.MuiAlert-standardInfo{color:#0d3c61;background-color:#e8f4fd}.MuiAlert-standardInfo .MuiAlert-icon{color:#2196f3}.MuiAlert-standardWarning{color:#663c00;background-color:#fff4e5}.MuiAlert-standardWarning .MuiAlert-icon{color:#ff9800}.MuiAlert-standardError{color:#611a15;background-color:#fdecea}.MuiAlert-standardError .MuiAlert-icon{color:#f44336}.MuiAlert-outlinedSuccess{color:#1e4620;border:1px solid #4caf50}.MuiAlert-outlinedSuccess .MuiAlert-icon{color:#4caf50}.MuiAlert-outlinedInfo{color:#0d3c61;border:1px solid #2196f3}.MuiAlert-outlinedInfo .MuiAlert-icon{color:#2196f3}.MuiAlert-outlinedWarning{color:#663c00;border:1px solid #ff9800}.MuiAlert-outlinedWarning .MuiAlert-icon{color:#ff9800}.MuiAlert-outlinedError{color:#611a15;border:1px solid #f44336}.MuiAlert-outlinedError .MuiAlert-icon{color:#f44336}.MuiAlert-filledSuccess{color:#fff;font-weight:500;background-color:#4caf50}.MuiAlert-filledInfo{color:#fff;font-weight:500;background-color:#2196f3}.MuiAlert-filledWarning{color:#fff;font-weight:500;background-color:#ff9800}.MuiAlert-filledError{color:#fff;font-weight:500;background-color:#f44336}.MuiAlert-icon{display:-webkit-box;display:flex;opacity:.9;padding:7px 0;font-size:22px;margin-right:12px}.MuiAlert-message{padding:8px 0}.MuiAlert-action{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;margin-left:auto;margin-right:-8px;padding-left:16px}</style><title data-react-helmet="true">Recoil 一个基于 actor 模型的 React 状态管理库 | Edward Elric&#x27;s Blog</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="前言 最近在 React Europe 2020 Conference 上， facebook 内部释出一个状态管理库 Recoil  通过官方的宣传以及初步的使用，Recoil 在处理 shared state 上比较方便，也能做到最小度的更新来提升复杂 App 的性能。不过有趣的是，对 Recoil…"/><meta data-react-helmet="true" property="og:title" content="Recoil 一个基于 actor 模型的 React 状态管理库"/><meta data-react-helmet="true" property="og:description" content="前言 最近在 React Europe 2020 Conference 上， facebook 内部释出一个状态管理库 Recoil  通过官方的宣传以及初步的使用，Recoil 在处理 shared state 上比较方便，也能做到最小度的更新来提升复杂 App 的性能。不过有趣的是，对 Recoil…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Edward Elric"/><meta data-react-helmet="true" name="twitter:title" content="Recoil 一个基于 actor 模型的 React 状态管理库"/><meta data-react-helmet="true" name="twitter:description" content="前言 最近在 React Europe 2020 Conference 上， facebook 内部释出一个状态管理库 Recoil  通过官方的宣传以及初步的使用，Recoil 在处理 shared state 上比较方便，也能做到最小度的更新来提升复杂 App 的性能。不过有趣的是，对 Recoil…"/><link as="script" rel="preload" href="/webpack-runtime-5473d1204b44d4d60a32.js"/><link as="script" rel="preload" href="/framework-a2b5d28827bc3716f133.js"/><link as="script" rel="preload" href="/app-11f3cb2e0fff14ff51c9.js"/><link as="script" rel="preload" href="/styles-e37f215f38ea08c0ee57.js"/><link as="script" rel="preload" href="/9df9159d3da413217f2de7c4a0a20731701b652b-32453a572dc233240309.js"/><link as="script" rel="preload" href="/ea91159724baebaba348fe71a459a442044fc186-f545b40d22fdad0ffa91.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-3e1251f9889fd88d5144.js"/><link as="fetch" rel="preload" href="/page-data/recoil-a-state-management-system-for-react/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="color:var(--textNormal);background:var(--bg);margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Edward Elric&#x27;s Blog</a></h3><div style="height:24px"></div></header><main><div class="MuiSnackbar-root MuiSnackbar-anchorOriginBottomCenter"><div class="MuiPaper-root MuiAlert-root MuiAlert-standardWarning MuiPaper-elevation0" role="alert" style="opacity:0;transform:scale(0.75, 0.5625)" direction="up"><div class="MuiAlert-icon"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"></path></svg></div><div class="MuiAlert-message">I support you to build your own blog instead of using Zhihu.com</div><div class="MuiAlert-action"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeSmall" tabindex="0" type="button" aria-label="Close" title="Close"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></span></button></div></div></div><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Recoil 一个基于 actor 模型的 React 状态管理库</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">2020-05-16</p></header><section><h1>前言</h1>
<p>最近在 React Europe 2020 Conference 上， facebook 内部释出一个状态管理库 <a href="https://recoiljs.org/">Recoil</a> </p>
<p>通过官方的宣传以及初步的使用，Recoil 在处理 shared state 上比较方便，也能做到最小度的更新来提升复杂 App 的性能。不过有趣的是，对 Recoil 的 <code class="language-text">atom</code> <code class="language-text">selector</code> 这些 API 设计而言，其实就是早在 47 年提出的 <strong>Actor Model</strong>，可谓是前端状态管理的文艺复兴。</p>
<h1>Actor Model 部分</h1>
<h2>什么是 Actor Model</h2>
<p>Actor 模型(Actor model)首先是由 Carl Hewitt 在1973定义， 由 Erlang OTP(Open Telecom Platform) 推广，其消息传递更加符合面向对象的原始意图。Actors 属于并发组件模型，通过组件方式定义并发编程范式的高级阶段，避免使用者直接接触多线程并发或线程池等基础概念。</p>
<p>流行语言并发是基于多线程之间的共享内存，使用同步方法防止写争夺，Actors 使用消息模型，每个 Actors 在同一时间处理最多一个消息，可以发送消息给其他 Actors，保证了单独写原则。从而巧妙避免了多线程写争夺。</p>
<p>Actor Model 主要有几个特点：</p>
<ul>
<li>轻量：Actor 是系统内的一个基础单位，每个 Actor 只负责自己的工作</li>
<li>没有 Shared State：每个 Actor 各自管理自己的 state，跑在各自的 thread 上，不共享内存和 state</li>
<li>通过消息传递：每个 Actor 有一个消息队列，类似 MailBox / Queue，接受到的消息会在此队列等待依次执行</li>
</ul>
<h2>谁使用 Actor Model</h2>
<ul>
<li>Erlang</li>
<li>Akka</li>
<li>Vert.x</li>
<li>…</li>
</ul>
<h1>Recoil 部分</h1>
<h2>Recoil 产生背景</h2>
<p>前端的应用越来越复杂，诸如常见的 Web 监控面板，包含各类的性能数据、节点信息、分类聚合用来进行应用分析。可以想象得到面板中包含各类的交互行为，编辑、删除、添加、将一个数据源绑定多个面板等等。除此之外，还需要对数据持久化，这样就能把 url 分享给其他人，并要确保被分享的人看到的是一致的。</p>
<p>因此开发过程中要尽量做到页面最小化更新达到高性能的目的，需要对数据流的操作更加精细。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3igH/8QAFRABAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAIDAAAAAAAAAAAAAAAAAAAQAREx/9oACAEBAAE/IbGqX//aAAwDAQACAAMAAAAQQA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQADAQAAAAAAAAAAAAABABEhMVGh/9oACAEBAAE/EDAU1lRwfYPbsW2t/9k='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recoil at React Europe 2020 00 00 12 "
        title="Recoil at React Europe 2020 00 00 12 "
        src="/static/987bc56102caab8fa8d4e1d49c7556c6/1c72d/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg"
        srcset="/static/987bc56102caab8fa8d4e1d49c7556c6/a80bd/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 148w,
/static/987bc56102caab8fa8d4e1d49c7556c6/1c91a/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 295w,
/static/987bc56102caab8fa8d4e1d49c7556c6/1c72d/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 590w,
/static/987bc56102caab8fa8d4e1d49c7556c6/a8a14/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 885w,
/static/987bc56102caab8fa8d4e1d49c7556c6/fbd2c/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 1180w,
/static/987bc56102caab8fa8d4e1d49c7556c6/0f98f/Recoil%20at%20React%20Europe%202020%2000-00-12%20.jpg 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>面对这样的挑战，一般会想到用一些状态管理的函数或者库，如 React 内置的 state 管理，或者 Redux。</p>
<p>Recoil 想通过一个不一样的方式来解决这些问题，主要分为 3 个方面：</p>
<ul>
<li>Flexible shared state: 在 react tree 任意的地方都能灵活共享 state，并保持高性能</li>
<li>Derived data and queries: 高效可靠地根据变化的 state 进行计算</li>
<li>App-wide state observation: time travel debugging, 支持 undo, 日志持久化</li>
</ul>
<h2>Recoil 主要设计</h2>
<h3>Shared state</h3>
<p>有一个应用基于这样一个场景，将 List 中更新一个节点，然后对应 Canvas 中的节点也更新</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVQoz6VRiwrCMAz0//9O3ERwgt2c3dut3Zru0em5IuJzoEcpIddLesni/BnGjMCXB4svnBCyadQvYsi01kLKuq7nxfihGUw/oSwrKaVNNiijaBgGY64s7vedlVKet4vjRAjxlE/TbM9YEBwQP4u7vufhce247nrj+8Ge+UVxwsBAEWkecsbYcuVAznkEI3aOVjwqomDrsZUDk1UlsixPkhSewcFAtPVw8rJE/yiKwbZte+9s/dCEruvgE4G1h5sUaSIkUQ7+1Y16GNinrY4vmN/zLP4SXwAdJoTKJiU22QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recoil at React Europe 2020 00 04 55 "
        title="Recoil at React Europe 2020 00 04 55 "
        src="/static/323cd8e613c052bfe07864140ad76304/fcda8/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png"
        srcset="/static/323cd8e613c052bfe07864140ad76304/12f09/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 148w,
/static/323cd8e613c052bfe07864140ad76304/e4a3f/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 295w,
/static/323cd8e613c052bfe07864140ad76304/fcda8/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 590w,
/static/323cd8e613c052bfe07864140ad76304/efc66/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 885w,
/static/323cd8e613c052bfe07864140ad76304/c83ae/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 1180w,
/static/323cd8e613c052bfe07864140ad76304/29114/Recoil%20at%20React%20Europe%202020%2000-04-55%20.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h4>第 1 种方式</h4>
<p>把 state 传到公共的父节点转发给 canvas 子节点，这样显然会全量 re-render</p>
<h4>第 2 种方式</h4>
<p>给父节点加 Provider 在子节点加 Consumer，不过每多加一个 item 就要多一层 Provider</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQoz42S227DIBBE/f/f2Cq1qyStKAYWcFhuzuBGKVItxfOwQisOsxeG9Z9qbVFp/ph+vLda65zzuqdhN5tzFZKV0kQEOMZ4CIZtSnVWIXCxlkyTTikdgq2L76Ml26wsaGr8UXhWLGTYul7JWpDzPB+FDfFye4wH3YYQ6qbXsL8lZRiHlDIzO+eWZYFtKa/gXKpUKefimnyMCYalFJh77xF/n+irGJ6L/Rb+7fR1vV7O5wsMu/lXjG0cp3H6RCN9/3/OzFEIgfEYQ9jw82PgNhGWhqSSUnLg/Z7jJmCIfXngkcEUUHz/2+4TDoa//ePaMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recoil at React Europe 2020 00 06 43 "
        title="Recoil at React Europe 2020 00 06 43 "
        src="/static/be68d83be5d0089eba9ca3ae541b4042/fcda8/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png"
        srcset="/static/be68d83be5d0089eba9ca3ae541b4042/12f09/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 148w,
/static/be68d83be5d0089eba9ca3ae541b4042/e4a3f/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 295w,
/static/be68d83be5d0089eba9ca3ae541b4042/fcda8/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 590w,
/static/be68d83be5d0089eba9ca3ae541b4042/efc66/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 885w,
/static/be68d83be5d0089eba9ca3ae541b4042/c83ae/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 1180w,
/static/be68d83be5d0089eba9ca3ae541b4042/29114/Recoil%20at%20React%20Europe%202020%2000-06-43%20.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h4>第 3 种方式</h4>
<p>在 react tree 上创建另一个正交的 tree，把每片 item 的 state 抽出来。每个 component 都有对应单独的一片 state，当数据更新的时候对应的组件也会更新。Recoil 把 这每一片的数据称为 Atom，Atom 是可订阅可变的 state 单元。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz11SWW/TQBD2/xdvPFWqKkF54oWXIihqQUJVSEOKnfhM5NiOHV/r27s+1t512MSCJvm02jl2Ps3szHD7c/hCHCjpWiwkIecVqJjlzMwlN5l6YBn4k2CT1pCFDcdg7pV3dGRuGeqJv61MHUlaaYXl3ArWQcw7vhLuZq5Oh+E/gxuGgVJKjuj7HiYojypbjgwTWmaxMAMTxKobaoG/iUMnjw5Z/vG5pm3zomjbtm4aBFG0S5IEbhSgif5yvXuWHNnyectYWFYKoVskZ2SmQ4hYcmb0HWnytsw6z2skwf4tG4IKFCfSEwAKZANgJ+CCvGcFI4QOSkcyr1QlsNLjlQ+Wss2r9lS0vDTP6sbJsi3wCaGvfx4Fxh3uOtpTY+5+uJHff+XfTWaPonz/ffbw2f/47c+PpXgvydssxE3bdd3+otu4xzBG4qN9fbO5+rK+fXm+M3hDcD69XV3dbt7cza+nT4vQYt2uqron5Iw87AfWsNSDqlrqHtTC0Kuytmy1SfT0K3sQvZ+WbmbhOJqyhGw03OmGMBtViHUe4xYfL1YhGTpCMGVvzGK+A3BVV03TcBcbRk9AxjMKSoeT9RjxF0LWZUUKBRK5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recoil at React Europe 2020 00 07 24 "
        title="Recoil at React Europe 2020 00 07 24 "
        src="/static/511f2376092c2d1eff023b9d688ade66/fcda8/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png"
        srcset="/static/511f2376092c2d1eff023b9d688ade66/12f09/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 148w,
/static/511f2376092c2d1eff023b9d688ade66/e4a3f/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 295w,
/static/511f2376092c2d1eff023b9d688ade66/fcda8/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 590w,
/static/511f2376092c2d1eff023b9d688ade66/efc66/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 885w,
/static/511f2376092c2d1eff023b9d688ade66/c83ae/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 1180w,
/static/511f2376092c2d1eff023b9d688ade66/29114/Recoil%20at%20React%20Europe%202020%2000-07-24%20.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>配合 <code class="language-text">useRecoilState</code> 可以使用这些 Atom，实践上对多个 item 的 Atom 可以用 memorize 进行优化，具体可以在官方文档查看，这里不赘述。</p>
<h3>Derived Data</h3>
<p>有这么一个场景需要根据多个 Item Box 计算 Bounding Box</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABBUlEQVQoz6VRa2+DMAzk//+/fqj6FBQSYOOVkDY0yc1J6FaqdtrD0uHgs072OcGLcM79CrdIrleHLB2Q5wOyrMXp1KNrNZSyGEcTIR8wmgUn53oQvFwsViuG3a6gfMB6nUEMKpDW/nRCYBhMeCdaW5quQ9P0BIG67qH19Lk2fe+wMGVRl2IWnCaHM633Hw99iHtB78WjyHfHehaLCZVaCoYGqcDYOzhvQq7rLnh666uqFox/8W919P3phD7aVmCzybHfM2y3BdK0gjHRGkv5eOSh7nnfxwoRBY1x6Hs6vbDkQ4SUlgQnlHxEWSrKiiY6R27u8f+BI3A20pXjIZMXTuEv4bf7ALtoDeb5/0aLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="derived data"
        title="derived data"
        src="/static/219ab74910774bb38966915f8dc02546/92d15/derived_data.png"
        srcset="/static/219ab74910774bb38966915f8dc02546/12f09/derived_data.png 148w,
/static/219ab74910774bb38966915f8dc02546/e4a3f/derived_data.png 295w,
/static/219ab74910774bb38966915f8dc02546/92d15/derived_data.png 581w"
        sizes="(max-width: 581px) 100vw, 581px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>如果你是 Vue 的爱好者，你可能想到了计算属性。Derived Data 确实有 computed props 的味道，具体思路是选取多个 Atom 进行计算，然后返回一个新的 state。因此在 Recoil 中设计了 <code class="language-text">select</code> 这样的 API 来选取多个 Atom 进行计算。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVQoz42R227DIAyG8/7vttvdrF00CTJlObQBAsY2UKfRqh62phYStuXP/g1VuTI8KDKtODklghQDxaFm0/gIBsDGUG6tuoszziXz4hDQ+MWul07lH3uAGdkNdNTw/S78mnsRXupw0qF5yxiek39MLjmT7XCof8eWV2EiijEiUnSGiM+HEJGZt2EhpVqE4rEhsAGW8JLfgHPOMkcc26tO7+WVmdgYsypKKW3sLApDCErrj91uHEfn3P6zVkoBgLS446tHMTJkmiZj7Dx7udv2p+t6N88Ce+9F3TP48kP5dqPVrotO7BGIr4HVhgwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Recoil at React Europe 2020 00 14 53 "
        title="Recoil at React Europe 2020 00 14 53 "
        src="/static/b5adda457e6be56398ba382b526116b8/fcda8/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png"
        srcset="/static/b5adda457e6be56398ba382b526116b8/12f09/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 148w,
/static/b5adda457e6be56398ba382b526116b8/e4a3f/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 295w,
/static/b5adda457e6be56398ba382b526116b8/fcda8/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 590w,
/static/b5adda457e6be56398ba382b526116b8/efc66/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 885w,
/static/b5adda457e6be56398ba382b526116b8/c83ae/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 1180w,
/static/b5adda457e6be56398ba382b526116b8/29114/Recoil%20at%20React%20Europe%202020%2000-14-53%20.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p><code class="language-text">select</code> 的设计和 Proxy 挺像的，属性上有 <code class="language-text">get</code> 进行读取，有 <code class="language-text">set</code> 进行设置，函数内部又有 <code class="language-text">get</code>， <code class="language-text">set</code> 操作 state</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>atom<span class="token punctuation">,</span> selector<span class="token punctuation">,</span> useRecoilState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'recoil'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tempFahrenheit <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">'tempFahrenheit'</span><span class="token punctuation">,</span>
  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tempCelcius <span class="token operator">=</span> <span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">'tempCelcius'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>tempFahrenheit<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">set</span><span class="token punctuation">}</span><span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">set</span><span class="token punctuation">(</span>tempFahrenheit<span class="token punctuation">,</span> <span class="token punctuation">(</span>newValue <span class="token operator">*</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3>App-wide observation</h3>
<p>这个场景下需要把 url 分享给其他人，别人打开相同的链接也能看到一样的页面。</p>
<p>那么就需要 observe Atom 的变更，Recoil 使用 <code class="language-text">useTransactionObservation</code> 进行订阅</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">useTransactionObservation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>atomValues<span class="token punctuation">,</span>modifiedAtoms<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>另一方面，打开链接的时候也需要对输入的数据进行校验</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">'myCounter'</span><span class="token punctuation">,</span>
  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  validator<span class="token operator">:</span> <span class="token punctuation">(</span>untrustedInput<span class="token punctuation">)</span><span class="token punctuation">,</span>
  metadata<span class="token operator">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h2>Recoil 后续</h2>
<p>目前 Recoil 还属于实验阶段，不过能确定的是 Recoil 会兼容 React Concurrent Mode</p>
<h1>Actor Model &#x26; Recoil 联系</h1>
<p>通过前面提及 Recoil 的设计，可以发现两者的理念是相似的。</p>
<p>在实现的细节中 Recoil 维护了新的队列，并通过订阅、派发的机制完成消息的传递及组件的更新。</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Fire or enqueue callbacks to rerender components that are subscribed to</span>
<span class="token comment">// nodes affected by the updatedNodes</span>
<span class="token keyword">function</span> <span class="token function">fireNodeSubscriptions</span><span class="token punctuation">(</span>
  store<span class="token operator">:</span> Store<span class="token punctuation">,</span>
  updatedNodes<span class="token operator">:</span> $ReadOnlySet<span class="token operator">&lt;</span>NodeKey<span class="token operator">></span><span class="token punctuation">,</span>
  when<span class="token operator">:</span> <span class="token string">'enqueue'</span> <span class="token operator">|</span> <span class="token string">'now'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
  This is called in two conditions: When an atom is set (with 'enqueue') and
  when an async selector resolves (with 'now'). When an atom is set, we want
  to use the latest dependencies that may have become dependencies due to
  earlier changes in a batch. But if an async selector happens to resolve during
  a batch, it should use the currently rendered output, and then the end of the
  batch will trigger any further subscriptions due to new deps in the new state.
  */</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span>
    when <span class="token operator">===</span> <span class="token string">'enqueue'</span>
      <span class="token operator">?</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>nextTree <span class="token operator">??</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>currentTree
      <span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>currentTree<span class="token punctuation">;</span>

  <span class="token keyword">const</span> dependentNodes <span class="token operator">=</span> <span class="token function">getDownstreamNodes</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> updatedNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> dependentNodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>state<span class="token punctuation">.</span>nodeToComponentSubscriptions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>debugName<span class="token punctuation">,</span> cb<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        when <span class="token operator">===</span> <span class="token string">'enqueue'</span>
          <span class="token operator">?</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queuedComponentCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
          <span class="token operator">:</span> <span class="token function">cb</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Wake all suspended components so the right one(s) can try to re-render.</span>
  <span class="token comment">// We need to wake up components not just when some asynchronous selector</span>
  <span class="token comment">// resolved (when === 'now'), but also when changing synchronous values because</span>
  <span class="token comment">// they may cause a selector to change from asynchronous to synchronous, in</span>
  <span class="token comment">// which case there would be no follow-up asynchronous resolution to wake us up.</span>
  <span class="token comment">// TODO OPTIMIZATION Only wake up related downstream components</span>
  Tracing<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>
    <span class="token string">'value became available, waking components'</span><span class="token punctuation">,</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>updatedNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> resolvers <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>suspendedComponentResolvers<span class="token punctuation">;</span>
      resolvers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=></span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      resolvers<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>其实 Recoil 不是 Actor Model 在前端的首次实践，2年前 PolymerLabs 就有 <a href="https://github.com/PolymerLabs/actor-helpers">actor-helpers</a> 以及 <a href="https://github.com/PolymerLabs/actor-boilerplate">actor-boilerplate</a> 相关的实践。不过在 React 强大的生态以及 React Hooks 的加持之下，用 Sync 的方式做到异步 state 管理和共享，同时保持交互流程、高性能的 Recoil 算是补充了一个不错的方案。</p>
<h1>补充</h1>
<p>Recoil 刚刚释出实验版本，我想正好可以在不断更改的过程中了解前端 Actor Model 的实现方式步骤。</p>
<p>另外，其实不少人批评前端的发展就是到处借鉴，没有新的事物，像是 WPF 就有很多前端可以借鉴的地方（确实也如此）。</p>
<p>不过在我看来，放到一个比较长的时期里，前端慢慢吸收各类后端、客户端的设计思想才产生“新”事物是很正常的发展进程。包括经常被提到的 Vue 和 React 孰优孰劣之争，Node.js 不堪大用等等话题，其实都是历史发展及其技术定位所致。可能对其他领域的看来是不新鲜，但对前端而言是语言发展（残疾而缝合的 JavaScript）、生态繁荣才有可能繁衍出这些对前端而言的新事物。</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-https://en.wikipedia.org/wiki/actor_model">
<p>Wikipedia Actor model</p>
<a href="#fnref-https://en.wikipedia.org/wiki/actor_model" class="footnote-backref">↩</a>
</li>
<li id="fn-http://jiangew.me/actor-model/#what-actor-model">
<p>Actor 编程模型浅谈</p>
<a href="#fnref-http://jiangew.me/actor-model/#what-actor-model" class="footnote-backref">↩</a>
</li>
<li id="fn-https://recoiljs.org/docs/api-reference/core/atom">
<p>Recoil Atom</p>
<a href="#fnref-https://recoiljs.org/docs/api-reference/core/atom" class="footnote-backref">↩</a>
</li>
<li id="fn-https://blog.techbridge.cc/2019/06/21/actor-model-in-web/">
<p>46 年老技術與 Web 的新火花 - Actor Model in Web</p>
<a href="#fnref-https://blog.techbridge.cc/2019/06/21/actor-model-in-web/" class="footnote-backref">↩</a>
</li>
</ol>
</div></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHrodCbiuQrREWAc//EABsQAAIDAAMAAAAAAAAAAAAAAAABAgMSESFB/9oACAEBAAEFAvUcIdj0rTZIXUGz/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQETFB/9oACAEDAQE/AcJFpv/EABYRAQEBAAAAAAAAAAAAAAAAABABQf/aAAgBAgEBPwHSn//EABkQAAIDAQAAAAAAAAAAAAAAAAAQATFxAv/aAAgBAQAGPwJ0Upw5xf/EABwQAQACAwADAAAAAAAAAAAAAAEAIRExUUFhcf/aAAgBAQABPyF1EljjOrAEKDfZm3R1MPI59XNlCVG8Iuftz//aAAwDAQACAAMAAAAQnBcB/8QAGREAAwADAAAAAAAAAAAAAAAAAAEREDFR/9oACAEDAQE/EFHDI5iez//EABkRAQACAwAAAAAAAAAAAAAAAAEAEBEhMf/aAAgBAgEBPxByU4i7n//EABwQAQADAAMBAQAAAAAAAAAAAAEAESExQYFRcf/aAAgBAQABPxCpZF4PsNjtnZVQAq17qNhwI1fkVtnJfk72G1a3Ax7MDWxPuxQtIvkBaiwLXmp//9k=" alt="Edward Elric" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/ce8bfa44d476d8e731987714a8c0b6f2/99438/profile-pic.jpg 1x,
/static/ce8bfa44d476d8e731987714a8c0b6f2/aba1d/profile-pic.jpg 1.5x,
/static/ce8bfa44d476d8e731987714a8c0b6f2/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/ce8bfa44d476d8e731987714a8c0b6f2/99438/profile-pic.jpg 1x,
/static/ce8bfa44d476d8e731987714a8c0b6f2/aba1d/profile-pic.jpg 1.5x,
/static/ce8bfa44d476d8e731987714a8c0b6f2/b315d/profile-pic.jpg 2x" src="/static/ce8bfa44d476d8e731987714a8c0b6f2/99438/profile-pic.jpg" alt="Edward Elric" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Edward Elric</strong> who lives and works in China building useful things. You can follow me on<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/edward688848">Zhihu</a>, <a href="https://twitter.com/SASUKE688848">Twitter</a><span> or </span><a target="_blank" rel="noopener noreferrer" href="https://github.com/sasuke40">Github</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/compare-vue-composition-api-with-react-hooks/">← <!-- -->对比 Vue Composition API 和 React Hooks</a></li><li></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built on<!-- --> <!-- -->2020-05-16 06:57<!-- --> <!-- -->with <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-46826341-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/recoil-a-state-management-system-for-react/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-11f3cb2e0fff14ff51c9.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-64046d74513a6b12aacf.js"],"component---src-pages-404-js":["/component---src-pages-404-js-69750cae003e4c0b332c.js"],"component---src-pages-friends-js":["/component---src-pages-friends-js-c38a22fcada0357688af.js"],"component---src-pages-index-js":["/component---src-pages-index-js-959c33e8fb17a00f9f03.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-3e1251f9889fd88d5144.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-3e1251f9889fd88d5144.js" async=""></script><script src="/ea91159724baebaba348fe71a459a442044fc186-f545b40d22fdad0ffa91.js" async=""></script><script src="/9df9159d3da413217f2de7c4a0a20731701b652b-32453a572dc233240309.js" async=""></script><script src="/styles-e37f215f38ea08c0ee57.js" async=""></script><script src="/app-11f3cb2e0fff14ff51c9.js" async=""></script><script src="/framework-a2b5d28827bc3716f133.js" async=""></script><script src="/webpack-runtime-5473d1204b44d4d60a32.js" async=""></script></body></html>